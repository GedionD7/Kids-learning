<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kids Fun Stories</title>
    <script src="bundle.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --accent: #2e7d32;
            --accent-light: #e8f5e9;
            --bg: #f8f9fa;
            --card: #ffffff;
            --muted: #6c757d;
            --border-color: #dee2e6;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: var(--bg);
            color: #212529;
            line-height: 1.6;
        }

        header {
            background: var(--accent);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .controls-container {
            background: var(--card);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
        }

        .language-selector {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-bottom: 1.5rem;
        }

        .lang-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--accent);
            background: white;
            color: var(--accent);
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .lang-btn.active, .lang-btn:hover {
            background: var(--accent);
            color: white;
        }

        nav {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .navbtn {
            background: #f0f0f0;
            border: 1px solid var(--border-color);
            color: #333;
            padding: 0.6rem 1.2rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.2s;
            white-space: nowrap;
        }
        .navbtn:hover { background: #e0e0e0; }
        .navbtn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .stories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .story-card {
            background: var(--card);
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        .story-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        .story-card img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .story-card-content {
            padding: 1rem;
        }

        .story-card-content h3 {
            margin: 0 0 0.5rem;
            color: var(--accent);
        }
        .story-card-content p {
            margin: 0;
            color: var(--muted);
        }

        /* Modal Styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background: white;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            border-radius: 12px;
            padding: 2rem;
            overflow-y: auto;
            position: relative;
        }

        .modal-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: #eee;
            border: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .modal-body h2 { color: var(--accent); }

        .audio-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            background: #f0f0f0;
            border-radius: 8px;
            margin: 1.5rem 0;
        }

        .audio-btn {
            padding: 0.7rem 1.2rem;
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .play-btn { background: var(--accent); }
        .stop-btn { background: var(--muted); }

        .audio-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .loading-spinner {
            width: 16px; height: 16px; border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%; border-top-color: #fff;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        #audioStatus {
            font-style: italic;
            color: var(--muted);
            text-align: center;
            min-height: 20px;
        }

        #modalText {
            white-space: pre-line;
        }

        .highlight-sentence {
            background-color: var(--accent-light);
            transition: background-color 0.3s;
        }
    </style>
</head>
<body>

<header>
    <h1>Kids Fun Stories</h1>
</header>

<main>
    <div class="controls-container">
        <div class="language-selector">
            <button class="lang-btn active" data-lang="english">English</button>
            <button class="lang-btn" data-lang="amharic">Amharic (·ä†·àõ·à≠·äõ)</button>
        </div>
        <nav id="categoryNav">
            <button class="navbtn active" data-category="all">All Stories</button>
            <button class="navbtn" data-category="bravery">ü¶Å Bravery</button>
            <button class="navbtn" data-category="kindness">‚ù§Ô∏è Kindness</button>
            <button class="navbtn" data-category="friendship">üêæ Friendship</button>
        </nav>
    </div>
    <div id="storiesGrid" class="stories-grid"></div>
</main>

<div id="storyModal" class="modal-overlay">
    <div class="modal-content">
        <button class="modal-close-btn">&times;</button>
        <div class="modal-body">
            <h2 id="modalTitle"></h2>
            <div class="audio-controls">
                <button id="playBtn" class="audio-btn play-btn"><i class="fas fa-play"></i> Listen</button>
                <button id="stopBtn" class="audio-btn stop-btn"><i class="fas fa-stop"></i> Stop</button>
            </div>
            <p id="audioStatus"></p>
            <div id="modalText"></div>
        </div>
    </div>
</div>

<script>
    // --- FULL STORY DATA RESTORED ---
    const stories = [
        {
            id: 1,
            title: { english: "Leo the Brave Little Lion", amharic: "·àä·ãÆ ·ã∞·çã·à© ·ä†·äï·â†·à≥" },
            category: "bravery",
            description: { english: "A small lion shows great courage", amharic: "·âµ·äï·àΩ ·ä†·äï·â†·à≥ ·â≥·àã·âÖ ·åÄ·åç·äï·äê·âµ ·ã´·à≥·ã´·àç" },
            image: "https://images.unsplash.com/photo-1552410260-0fd9b577afa6?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80",
            text: {
                english: `In the sunny jungle of Golden Tree, there lived a little lion named Leo. Leo was smaller than the other lions, but he had the biggest heart of them all. He loved exploring, playing with friends, and helping anyone in need.
One bright morning, Leo was walking near the river when he heard a faint cry. "Help! Help!" the voice said. Curious, Leo followed the sound and found his friend, Tilly the turtle, stuck in a thorn bush. Her little legs couldn't free her.
All the other animals saw this, but they were too scared to come close. "The thorns are too sharp," said a monkey. "I can't help," said a giraffe.
But Leo stepped forward. "Don't worry, Tilly! I will help you!" he said. Carefully, he pulled away the thorns, one by one, until Tilly was free. Tilly hugged him tightly. "Thank you, Leo! You are brave!"
From that day on, all the animals in the jungle knew that even the smallest lion can be the bravest of all. And Leo learned that helping others is more important than being the biggest or strongest.`,
                amharic: `·â†·ãà·à≠·âÉ·àõ·ãç ·ãõ·çç ·å´·ä´ ·ãç·àµ·å• ·àä·ãÆ ·ã®·àö·â£·àç ·âµ·äï·àΩ ·ä†·äï·â†·à≥ ·äê·â†·à≠·ç¢ ·àä·ãÆ ·ä®·àå·àé·âπ ·ä†·äï·â†·à∂·âΩ ·ã´·äê·à∞ ·äê·â†·à≠·ç£ ·äê·åà·à≠ ·åç·äï ·ä®·àÅ·àâ·àù ·âµ·àç·âÖ ·àç·â• ·äê·â†·à®·ãç·ç¢ ·àò·àò·à≠·àò·à≠ ·ç£ ·ä®·åì·ã∞·äû·âπ ·åã·à≠ ·àò·å´·ãà·âµ ·ä•·äì ·àà·àö·ã´·àµ·çà·àç·åà·ãç ·àõ·äï·äõ·ãç·àù ·à∞·ãç ·àò·à≠·ã≥·âµ ·ã≠·ãà·ãµ ·äê·â†·à≠·ç¢
·ä†·äï·ãµ ·âÄ·äï ·â†·â•·à©·àÖ ·àõ·àà·ã≥ ·àä·ãÆ ·â†·ãà·äï·ãô ·ä†·å†·åà·â• ·ä•·ã®·àÑ·ã∞ ·à≥·àà ·ã∞·ä´·àõ ·å©·ä∏·âµ ·à∞·àõ ·ç¢ "·ä•·à≠·ã±·äù! ·ä•·à≠·ã±·äù!"·ä†·àà ·ãµ·àù·çÅ·ç¢·ã®·àõ·ãà·âÖ ·åâ·åâ·âµ ·ã´·àà·ãç ·àä·ãÆ ·ãµ·àù·çÅ·äï ·â∞·ä®·âµ·àé ·åì·ã∞·äõ·ãç·äï ·â≤·àä ·ä§·àä·ãç ·â†·ä•·àæ·àÖ ·âÅ·å•·âã·å¶ ·ãç·àµ·å• ·â∞·å£·â•·âÜ ·ä†·åà·äò·ãç·ç¢·âµ·äï·äï·àΩ ·ä•·åç·àÆ·âø  ·äê·çÉ ·àä·ãà·å°·àã·âµ ·ä†·àç·âª·àâ·àù ·ç¢
·àå·àé·âπ ·ä•·äï·àµ·à≥·âµ ·àÅ·àâ ·ã≠·àÖ·äï·äï ·ä†·ã© ·ç£ ·äê·åà·à≠ ·åç·äï ·àà·àò·âÖ·à®·â• ·â†·å£·àù ·çà·à©·ç¢ "·ä•·àæ·àÜ·âπ ·â†·å£·àù ·àπ·àç ·äì·â∏·ãç" ·ä†·àà·âΩ ·ãù·äï·åÄ·àÆ·ç¢ "·àò·à≠·ã≥·âµ ·ä†·àç·âΩ·àç·àù" ·ä†·àà·âΩ ·âÄ·å≠·äî·ç¢
·äê·åà·à≠ ·åç·äï ·àä·ãÆ ·ãà·ã∞·çä·âµ ·àÑ·ã∞·ç¢ "·ä†·âµ·å®·äê·âÇ ·ç£ ·â≤·àä! ·ä•·à®·ã≥·àª·àà·àÅ!" ·ä†·àã·âµ·ç¢ ·â†·å•·äï·âÉ·âÑ ·ä•·àæ·àÜ·âπ·äï ·ç£ ·ä†·äï·ãµ ·â†·ä†·äï·ãµ ·ç£ ·â≤·àä ·ä•·àµ·ä≠·âµ·çà·â≥ ·ãµ·à®·àµ ·ä†·äê·à≥·ç¢ ·â≤·àä ·â†·å•·â•·âÖ ·ä†·âÄ·çà·âΩ·ãç·ç¢ "·ä†·àò·à∞·åç·äì·àà·àÅ ·ç£ ·àä·ãÆ! ·ã∞·çã·à≠ ·äê·àÖ!"
·ä®·ãö·ã´ ·âÄ·äï ·åÄ·àù·àÆ ·â†·å´·ä´·ãç ·ãç·àµ·å• ·ã´·àâ ·àÅ·àâ·àù ·ä•·äï·àµ·à≥·âµ ·âµ·äï·àπ ·ä†·äï·â†·à≥ ·ä•·äï·ä≥ ·ä®·àÅ·àâ·àù ·ã∞·çã·à≠ ·àò·àÜ·äë·äï ·ä†·ãà·âÅ·ç¢ ·ä•·äì ·àä·ãÆ ·àå·àé·âΩ·äï ·àõ·åà·ãù ·âµ·àç·âÖ ·ãà·ã≠·àù ·å†·äï·ä´·à´ ·ä®·àò·àÜ·äï ·ã®·â†·àà·å† ·ä†·àµ·çà·àã·åä ·àò·àÜ·äë·äï ·â∞·àõ·à®·ç¢`
            }
        },
        {
            id: 2,
            title: { english: "Mia the Kind Monkey", amharic: "·àö·ã´ ·ã∞·åì ·ãù·äï·åÄ·àÆ" },
            category: "kindness",
            description: { english: "A curious monkey helps find a lost key", amharic: "·åâ·åâ·âµ ·ã´·àà·ãç ·ãù·äï·åÄ·àÆ ·ã®·å†·çã ·âÅ·àç·çç ·àà·àõ·åç·äò·âµ ·ã≠·à®·ã≥·àç" },
            image: "https://images.unsplash.com/photo-1540573133985-87b6da6d54a9?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80",
            text: {
                english: `Mia was a young monkey who loved exploring. Every morning, she swung from branch to branch, discovering new places in the jungle. One day, while playing near the riverbank, she noticed something shiny on the ground.
"What could this be?" Mia wondered. She picked it up and saw it was a golden key. She didn't know whose it was, but she wanted to help. Mia hopped from tree to tree asking her friends if it belonged to anyone.
Finally, she reached Mr. Elephant, who had lost his treasure chest key days ago. "Mia! You found it!" he exclaimed, tears of happiness in his eyes. "You are very clever and kind."
Mia felt proud. She realized that curiosity can help others, especially when you are willing to take action.`,
                amharic: `·àö·ã´ ·àò·àò·à≠·àò·à≠ ·ã®·àù·âµ·ãà·ãµ ·ãà·å£·âµ ·ãù·äï·åÄ·àÆ ·äê·â†·à®·âΩ·ç¢ ·â†·ã®·å†·ãã·â± ·ä®·âÖ·à≠·äï·å´·çç ·ãà·ã∞ ·âÖ·à≠·äï·å´·çç ·ä•·ã®·ãò·àà·àà·âΩ ·â†·å´·ä´·ãç ·ãç·àµ·å• ·ä†·ã≥·ã≤·àµ ·â¶·â≥·ãé·âΩ·äï ·â≥·åà·äõ·àà·âΩ·ç¢ ·ä†·äï·ãµ ·âÄ·äï ·ç£ ·ä®·ãà·äï·ãù ·ã≥·à≠·âª ·ä†·å†·åà·â• ·àµ·âµ·å´·ãà·âµ ·ç£ ·àò·à¨·âµ ·àã·ã≠ ·ã®·àö·ã´·â•·à®·âÄ·à≠·âÖ ·äê·åà·à≠ ·ä†·ã®·âΩ·ç¢
"·ã≠·àÖ ·àù·äï ·àä·àÜ·äï ·ã≠·âΩ·àã·àç?" ·àö·ã´ ·ä†·à∞·â†·âΩ·ç¢ ·ä†·äï·àµ·â≥ ·àµ·âµ·àò·àà·ä®·âµ ·ãà·à≠·âÉ·àõ ·âÅ·àç·çç ·äê·â†·à≠·ç¢ ·ã®·àõ·äï ·ä•·äï·ã∞·àÜ·äê ·â£·â≥·ãç·âÖ·àù ·àò·à≠·ã≥·âµ ·çà·àà·åà·âΩ·ç¢ ·àö·ã´ ·ä®·ãõ·çç ·ãà·ã∞ ·ãõ·çç ·ä•·ã®·ãò·àà·àà·âΩ ·åì·ã∞·äû·âø·äï ·ã®·àõ·äï ·ä•·äï·ã∞·àÜ·äê ·å†·ã®·âÄ·âΩ·ç¢
·â†·àò·å®·à®·àª·àù·ç£ ·ä®·âÄ·äì·âµ ·â†·çä·âµ ·ã®·àÄ·â•·âµ ·à≥·å•·äë·äï ·âÅ·àç·çç ·ã´·å£·ãç·äï ·ä†·â∂ ·ãù·àÜ·äï·äï ·ä†·åà·äò·âΩ·ç¢ "·àö·ã´! ·ä†·åà·äò·àΩ·ãç!" ·â•·àé ·â†·ã∞·àµ·â≥ ·åÆ·ä∏·ç¢ "·â†·å£·àù ·â•·àç·àÖ ·ä•·äì ·ã∞·åç ·äê·àΩ·ç¢"
·àö·ã´ ·ä©·à´·âµ ·â∞·à∞·àõ·âµ·ç¢ ·åâ·åâ·âµ ·â†·â∞·åç·â£·à≠ ·à≤·ã∞·åà·çç ·àå·àé·âΩ·äï ·àò·à≠·ã≥·âµ ·ä•·äï·ã∞·àö·âΩ·àç ·â∞·åà·äê·ãò·â†·âΩ·ç¢`
            }
        },
        {
            id: 3,
            title: { english: "Benny the Brave Bunny", amharic: "·â§·äí ·ã∞·çã·à© ·å•·äï·â∏·àç" },
            category: "bravery",
            description: { english: "A bunny saves a bird from danger", amharic: "·å•·äï·â∏·àç ·ãà·çç·äï ·ä®·ä†·ã∞·åã ·ã´·ãµ·äì·àç" },
            image: "https://images.unsplash.com/photo-1518796745738-41048802f99a?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80",
            text: {
                english: `Benny loved munching on carrots in his garden, but he also had a brave heart. One sunny morning, he heard a faint chirping sound. A little bird was tangled in a net near the bushes.
Benny looked around. All the other bunnies ran away. "It looks dangerous," said one. But Benny didn't hesitate. Using his sharp teeth carefully, he nibbled the net until the bird was free.
"Thank you, Benny! You saved me!" chirped the bird happily. From that day, Benny was known as the bravest bunny in the meadow. He learned that helping friends is always worth the risk.`,
                amharic: `·â§·äí ·â†·ä†·âµ·ä≠·àç·â± ·ãç·àµ·å• ·ä´·àÆ·âµ ·àò·àò·åà·â• ·ã≠·ãà·ãµ ·äê·â†·à≠ ·ç£ ·äê·åà·à≠ ·åç·äï ·ã∞·çã·à≠ ·àç·â•·àù ·äê·â†·à®·ãç·ç¢ ·ä†·äï·ãµ ·çÄ·àê·ã´·àõ ·å†·ãã·âµ ·ç£ ·ã∞·ä´·àõ ·ã® ·ãà·çç ·å©·ä∏·âµ ·à∞·àõ·ç¢ ·ä†·äï·ã≤·âµ ·âµ·äï·àΩ ·ãà·çç ·ä®·âÅ·å•·âã·å¶·ãé·âπ ·ä†·å†·åà·â• ·â†·àò·à®·â• ·â∞·å†·àç·çã ·äê·â†·à≠·ç¢
·â§·äí ·ãô·à™·ã´·ãç·äï ·â∞·àò·àà·ä®·â∞·ç¢ ·àå·àé·âπ ·å•·äï·â∏·àé·âΩ ·àÅ·àâ ·à∏·àπ·ç¢ "·ä†·ã∞·åà·äõ ·ã≠·àò·àµ·àã·àç" ·ä†·àà ·ä†·äï·ã±·ç¢ ·äê·åà·à≠ ·åç·äï ·â§·äí ·ä†·àã·àò·äê·â≥·àù·ç¢ ·àπ·àç ·å•·à≠·à∂·âπ·äï ·â†·å•·äï·âÉ·âÑ ·â†·àò·å†·âÄ·àù ·ç£ ·ãà·çè ·äê·çÉ ·ä•·àµ·ä≠·âµ·ãà·å£ ·ãµ·à®·àµ ·àò·à®·â°·äï ·âÜ·à®·å†·ç¢
"·ä†·àò·à∞·åç·äì·àà·àÅ ·ç£ ·â§·äí! ·ä†·ã≥·äï·ä®·äù!" ·ãà·çè ·â†·ã∞·àµ·â≥ ·åÆ·ä∏·âΩ·ç¢ ·ä®·ãö·ã´ ·âÄ·äï ·åÄ·àù·àÆ ·â§·äí ·â†·àú·ã≥·ãç ·ãç·àµ·å• ·â†·å£·àù ·ã∞·çã·à≠ ·å•·äï·â∏·àç ·â†·àò·â£·àç ·ã≠·â≥·ãà·âÖ ·äê·â†·à≠·ç¢ ·åì·ã∞·äû·âΩ·äï ·àò·à≠·ã≥·âµ ·àÅ·àç·åä·ãú·àù ·ãã·åã ·ã´·àà·ãç ·àò·àÜ·äë·äï ·â∞·àõ·à®·ç¢`
            }
        },
        {
            id: 4,
            title: { english: "Sparkle the Kind Fish", amharic: "·àµ·çì·à≠·ä≠·àç ·ã∞·åâ ·ä†·à≥" },
            category: "kindness",
            description: { english: "A small fish helps a stranded frog", amharic: "·âµ·äï·àΩ ·ä†·à≥ ·ã®·â∞·â∏·åà·à® ·ä•·äï·âÅ·à´·à™·âµ ·ã≠·à®·ã≥·àç" },
            image: "https://images.unsplash.com/photo-1518837695005-2083093ee35b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80",
            text: {
                english: `In a sparkling blue pond, lived Sparkle, a small fish with shimmering scales. Sparkle loved swimming and exploring every corner of the pond.
One day, Sparkle noticed a tiny frog stranded on a rock. The frog was scared. Sparkle thought quickly. "Don't worry, I'll help you!" she said.
She splashed water gently to cool the frog and nudged it carefully toward the water. The frog finally hopped safely into the pond. "Thank you, Sparkle! You are so kind!" said the frog.
Sparkle learned that even small creatures can make a big difference when they show kindness.`,
                amharic: `·â†·àö·ã´·â•·à®·âÄ·à≠·âÖ ·à∞·àõ·ã´·ãä ·ä©·à¨ ·ãç·àµ·å• ·àµ·çì·à≠·ä≠·àç ·ã®·àù·âµ·â£·àç ·âµ·äï·àΩ ·ä†·à≥ ·âµ·äñ·à≠ ·äê·â†·à≠·ç¢ ·àµ·çì·à≠·ä≠·àç ·àò·ãã·äò·âµ ·ä•·äì ·ã®·ä©·à¨·ãç·äï ·ä•·ã´·äï·ã≥·äï·ã±·äï ·å•·åç ·àò·àò·à≠·àò·à≠ ·âµ·ãà·ãµ ·äê·â†·à≠·ç¢
·ä†·äï·ãµ ·âÄ·äï ·àµ·çì·à≠·ä≠·àç ·ãµ·äï·åã·ã≠ ·àã·ã≠ ·â∞·âÄ·àù·å¶ ·ã®·çà·à´ ·âµ·äï·àΩ ·ä•·äï·âÅ·à´·à™·âµ ·ä†·ã®·âΩ·ç¢ ·àµ·çì·à≠·ä≠·àç ·â†·çç·å•·äê·âµ ·ä†·à∞·â†·âΩ·ç¢ "·ä†·âµ·å®·äê·âÖ ·ä•·à®·ã≥·àÉ·àà·àÅ!" ·ä†·àà·âΩ·ãç·ç¢
·ä•·äï·âÅ·à´·à™·â±·äï ·àà·àõ·âÄ·ãù·âÄ·ãù ·ãç·àÉ ·à®·å®·âΩ·â†·âµ ·ä•·äì ·â†·å•·äï·âÉ·âÑ ·ãà·ã∞ ·ãç·àÉ·ãç ·åà·çã·âΩ·ãç·ç¢ ·ä•·äï·âÅ·à´·à™·â± ·â†·à∞·àã·àù ·ãà·ã∞ ·ä©·à¨·ãç ·åà·â£·ç¢ "·ä†·àò·à∞·åç·äì·àà·àÅ ·àµ·çì·à≠·ä≠·àç! ·â†·å£·àù ·ã∞·åç ·äê·àΩ!" ·ä†·àà ·ä•·äï·âÅ·à´·à™·â±·ç¢
·àµ·çì·à≠·ä≠·àç ·âµ·äì·äï·àΩ ·çç·å•·à®·â≥·âµ ·ä•·äï·ä≥ ·ã∞·åç·äê·âµ ·à≤·ã´·à≥·ã© ·âµ·àç·âÖ ·àà·ãç·å• ·àõ·àù·å£·âµ ·ä•·äï·ã∞·àö·âΩ·àâ ·â∞·àõ·à®·âΩ·ç¢`
            }
        },
        {
            id: 5,
            title: { english: "Timmy and the Race", amharic: "·â≤·àö ·ä•·äì ·ãç·ãµ·ãµ·à©" },
            category: "friendship",
            description: { english: "A slow turtle shows his own strength", amharic: "·ãù·åç·â∞·äõ ·ä§·àä ·ã®·à´·à±·äï ·å•·äï·ä´·à¨ ·ã´·à≥·ã´·àç" },
            image: "https://images.unsplash.com/photo-1673632118149-95cf2136c73f?ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8dHVydGxlJTIwcmFjZXxlbnwwfHwwfHx8MA%3D%3D&auto=format&fit=crop&q=60&w=600 ",
            text: {
                english: `Timmy was the smallest turtle in the forest. He was often teased for being slow. "You'll never win a race!" the other animals would say.
One day, there was a big race to the top of Sunny Hill. The fast rabbit zipped ahead, but soon got tired and took a nap. The other animals ran fast but got distracted.
Timmy just kept going, slow and steady. He never stopped. One by one, he passed the sleeping rabbit and the distracted animals.
To everyone's surprise, Timmy the turtle was the first to reach the top of the hill. He learned that being slow and steady can win the race.`,
                amharic: `·â≤·àö ·â†·å´·ä´·ãç ·ãç·àµ·å• ·â†·å£·àù ·âµ·äï·àπ ·ä§·àä ·äê·â†·à≠·ç¢ ·ãù·åç·â∞·äõ ·â†·àò·àÜ·äë ·â•·ãô ·åä·ãú ·ã≠·à≥·àà·âÅ·â†·âµ ·äê·â†·à≠·ç¢ "·ãç·ãµ·ãµ·à≠ ·â†·çç·åπ·àù ·ä†·â≥·à∏·äï·çç·àù!" ·ã≠·àâ·âµ ·äê·â†·à≠ ·àå·àé·âπ ·ä•·äï·àµ·à≥·âµ·ç¢
·ä†·äï·ãµ ·âÄ·äï ·ãà·ã∞ ·çÄ·àê·ã´·àõ ·äÆ·à®·â•·â≥ ·å´·çç ·âµ·àç·âÖ ·ãç·ãµ·ãµ·à≠ ·äê·â†·à≠·ç¢ ·çà·å£·äë ·å•·äï·â∏·àç ·â†·çç·å•·äê·âµ ·àÑ·ã∞·ç£ ·äê·åà·à≠ ·åç·äï ·â•·ãô·àù ·à≥·ã≠·âÜ·ã≠ ·ã∞·ä≠·àû ·ä•·äï·âÖ·àç·çç ·ãà·à∞·ã∞·ãç·ç¢ ·àå·àé·âπ ·ä•·äï·àµ·à≥·âµ ·â†·çç·å•·äê·âµ ·àÆ·å° ·åç·äï ·âµ·ä©·à®·â≥·â∏·ãç ·â∞·â†·â≥·â∞·äê·ç¢
·â≤·àö ·åç·äï ·ãù·åç ·ä•·äì ·åΩ·äë ·àÜ·äñ ·åâ·ãû·ãç·äï ·âÄ·å†·àà·ç¢ ·â†·çç·åπ·àù ·ä†·àã·âÜ·àò·àù·ç¢ ·ä†·äï·ãµ ·â†·ä†·äï·ãµ·ç£ ·ã®·â∞·äõ·ãç·äï ·å•·äï·â∏·àç ·ä•·äì ·âµ·ä©·à®·â≥·â∏·ãç ·ã®·â∞·â†·â≥·â∞·äë·âµ·äï ·ä•·äï·àµ·à≥·âµ ·ä†·àà·çã·â∏·ãç·ç¢
·àà·àÅ·àâ·àù ·â†·àö·ã´·àµ·ã∞·äï·âÖ ·àÅ·äî·â≥·ç£ ·â≤·àö ·ä§·àä·ãç ·ã®·äÆ·à®·â•·â≥·ãç·äï ·å´·çç ·àà·àò·ãµ·à®·àµ ·ã®·àò·åÄ·àò·à™·ã´·ãç ·àÜ·äê·ç¢ ·ãù·åç ·ä•·äì ·åΩ·äë ·àò·àÜ·äï ·ãç·ãµ·ãµ·à©·äï ·àä·ã´·à∏·äï·çç ·ä•·äï·ã∞·àö·âΩ·àç ·â∞·àõ·à®·ç¢`
            }
        },
        {
            id: 6,
            title: { english: "Lulu and the Lost Star", amharic: "·àâ·àâ ·ä•·äì ·ã®·å†·çã·ãç ·äÆ·ä®·â•" },
            category: "friendship",
            description: { english: "A lioness helps a friend in need", amharic: "·ä†·äï·â†·à≥ ·ã®·â∞·â∏·åà·à® ·åì·ã∞·äõ·ãã·äï ·âµ·à®·ã≥·àà·âΩ" },
            image: "https://images.unsplash.com/photo-1546182990-dffeafbe841d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80",
            text: {
                english: `Lulu the lioness loved watching the stars. One night, she saw a little star fall from the sky and land in the tall grass. The little star was crying.
"I'm lost and I can't get back home!" it sobbed. Lulu felt sad for the star. "I will help you," she said gently.
Lulu carried the little star on her back and climbed to the highest point in the jungle. "Can you see your family now?" she asked.
"Yes! I can!" the star twinkled happily. It floated back up into the sky to join the other stars. Lulu knew that a good friend always helps, no matter how big or small the problem is.`,
                amharic: `·àâ·àâ ·ä†·äï·â†·à≥·ãã ·ä®·ãã·ä≠·â•·âµ·äï ·àò·àò·àç·ä®·âµ ·âµ·ãà·ãµ ·äê·â†·à≠·ç¢ ·ä†·äï·ãµ ·àù·àΩ·âµ·ç£ ·ä†·äï·ãµ ·âµ·äï·àΩ ·äÆ·ä®·â• ·ä®·à∞·àõ·ã≠ ·ãà·ãµ·âÜ ·â†·à®·åÖ·àù ·à≥·à≠ ·ãç·àµ·å• ·à≤·ã´·à≠·çç ·ä†·ã®·âΩ·ç¢ ·âµ·äï·àπ ·äÆ·ä®·â• ·ä•·ã´·àà·âÄ·à∞ ·äê·â†·à≠·ç¢
"·å†·çç·âª·àà·àÅ ·ä•·äì ·ãà·ã∞ ·â§·â¥ ·àò·àò·àà·àµ ·ä†·àç·âΩ·àç·àù!" ·â•·àé ·ä†·àà·âÄ·à∞·ç¢ ·àâ·àâ ·àà·äÆ·ä®·â° ·ä†·ãò·äê·âΩ·ç¢ "·ä•·à®·ã≥·àÉ·àà·àÅ" ·ä†·àà·âΩ·ãç ·â†·âÄ·àµ·â≥·ç¢
·àâ·àâ ·âµ·äï·àπ·äï ·äÆ·ä®·â• ·â†·åÄ·à≠·â£·ãã ·àã·ã≠ ·â∞·à∏·ä≠·àõ ·â†·å´·ä´·ãç ·ãç·àµ·å• ·ãà·ã∞·àö·åà·äò·ãç ·à®·åÖ·àô ·â¶·â≥ ·ãà·å£·âΩ·ç¢ "·ä†·àÅ·äï ·â§·â∞·à∞·â•·àÖ·äï ·àõ·ã®·âµ ·âµ·âΩ·àã·àà·àÖ?" ·â•·àã ·å†·ã®·âÄ·âΩ·ãç·ç¢
"·ä†·ãé! ·ä•·âΩ·àã·àà·àÅ!" ·äÆ·ä®·â° ·â†·ã∞·àµ·â≥ ·ä†·äï·å∏·â£·à®·âÄ·ç¢ ·ãà·ã∞ ·à∞·àõ·ã≠ ·â∞·àò·àç·à∂ ·ä®·àå·àé·âπ ·ä®·ãã·ä≠·â•·âµ ·åã·à≠ ·â∞·âÄ·àã·âÄ·àà·ç¢ ·àâ·àâ ·å•·à© ·åì·ã∞·äõ ·âΩ·åç·à© ·âµ·àç·âÖ·àù ·ã≠·àÅ·äï ·âµ·äï·àΩ ·àÅ·àç·åä·ãú·àù ·ä•·äï·ã∞·àö·à®·ã≥ ·ä†·ãà·âÄ·âΩ·ç¢`
            }
        }
    ];

    // --- GLOBAL VARIABLES ---
    let currentLanguage = 'english';
    const storiesGrid = document.getElementById('storiesGrid');
    const modal = document.getElementById('storyModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalText = document.getElementById('modalText');

    // --- FIX: A NEAT AUDIO PLAYER OBJECT TO HANDLE ALL SOUND LOGIC ---
    const AudioPlayer = {
        playlist: [],
        currentIndex: 0,
        audioElement: new Audio(),
        isPlaying: false,
        isPaused: false,

        _createTextChunks(text) {
            const sentences = text.match(/[^.!?‚Ä¶]+[.!?‚Ä¶]*/g) || [text];
            const chunks = [];
            sentences.forEach(sentence => {
                if (sentence.length > 180) { // Further split very long sentences
                    let subChunk = '';
                    const words = sentence.trim().split(' ');
                    words.forEach(word => {
                        if ((subChunk + word).length > 180) {
                            chunks.push(subChunk.trim());
                            subChunk = '';
                        }
                        subChunk += word + ' ';
                    });
                    if (subChunk) chunks.push(subChunk.trim());
                } else {
                    chunks.push(sentence.trim());
                }
            });
            return chunks.filter(c => c); // Filter out empty chunks
        },

        _playNextChunk() {
            this._highlightCurrentSentence();
            if (this.currentIndex < this.playlist.length && this.isPlaying) {
                this.audioElement.src = this.playlist[this.currentIndex];
                this.audioElement.play().catch(e => {
                    console.error("Chunk play error:", e);
                    this.stop(); // Stop on error
                });
                this.currentIndex++;
            } else {
                this.stop();
            }
        },

        _highlightCurrentSentence() {
            const spans = modalText.querySelectorAll('span');
            spans.forEach(span => span.classList.remove('highlight-sentence'));
            // Highlight based on previous index since currentIndex is already incremented
            const highlightIndex = this.currentIndex > 0 ? this.currentIndex - 1 : 0;
            if (this.isPlaying && spans[highlightIndex]) {
                spans[highlightIndex].classList.add('highlight-sentence');
            }
        },

        play(text, lang) {
            if (this.isPaused) {
                this.resume();
                return;
            }
            this.stop();
            this.isPlaying = true;
            this.isPaused = false;

            const chunks = this._createTextChunks(text);
            const langCode = lang === 'english' ? 'en' : 'am';
            this.playlist = chunks.map(chunk => {
                const encodedChunk = encodeURIComponent(chunk);
                return `https://translate.google.com/translate_tts?ie=UTF-8&tl=${langCode}&client=tw-ob&q=${encodedChunk}`;
            });

            this.currentIndex = 0;
            this._playNextChunk();
            this.updateUI('playing');
        },

        pause() {
            if (!this.isPlaying) return;
            this.audioElement.pause();
            this.isPaused = true;
            this.isPlaying = false;
            this.updateUI('paused');
        },

        resume() {
            if (!this.isPaused) return;
            this.isPaused = false;
            this.isPlaying = true;
            this.audioElement.play().catch(e => this.stop());
            this.updateUI('playing');
        },

        stop() {
            this.audioElement.pause();
            this.audioElement.src = "";
            this.playlist = [];
            this.currentIndex = 0;
            this.isPlaying = false;
            this.isPaused = false;
            this._highlightCurrentSentence(); // Clears highlight
            this.updateUI('stopped');
        },

        updateUI(state) {
            const playBtn = document.getElementById('playBtn');
            const audioStatus = document.getElementById('audioStatus');

            if (state === 'playing') {
                playBtn.innerHTML = `<i class="fas fa-pause"></i> Pause`;
                audioStatus.textContent = 'Playing...';
            } else if (state === 'paused') {
                playBtn.innerHTML = `<i class="fas fa-play"></i> Resume`;
                audioStatus.textContent = 'Paused.';
            } else {
                playBtn.innerHTML = `<i class="fas fa-play"></i> Listen`;
                audioStatus.textContent = 'Ready to play.';
            }
        }
    };

    // --- UI & APP LOGIC ---

    function renderStories(category = 'all') {
        storiesGrid.innerHTML = '';
        const filteredStories = category === 'all'
            ? stories
            : stories.filter(story => story.category === category);

        filteredStories.forEach(story => {
            const card = document.createElement('div');
            card.className = 'story-card';
            card.innerHTML = `
                <img src="${story.image}" alt="${story.title[currentLanguage]}">
                <div class="story-card-content">
                    <h3>${story.title[currentLanguage]}</h3>
                    <p>${story.description[currentLanguage]}</p>
                </div>
            `;
            card.addEventListener('click', () => openModal(story));
            storiesGrid.appendChild(card);
        });
    }

    function openModal(story) {
        modalTitle.textContent = story.title[currentLanguage];
        const sentences = story.text[currentLanguage].match(/[^.!?‚Ä¶]+[.!?‚Ä¶]*/g) || [];
        modalText.innerHTML = sentences.map(s => `<span>${s.trim()}</span>`).join(' ');
        modal.story = story;
        modal.classList.add('active');
        AudioPlayer.updateUI('stopped');
    }

    function closeModal() {
        AudioPlayer.stop();
        modal.classList.remove('active');
    }

    // --- EVENT LISTENERS ---
    document.addEventListener('DOMContentLoaded', () => {
        renderStories();

        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelector('.lang-btn.active').classList.remove('active');
                btn.classList.add('active');
                currentLanguage = btn.dataset.lang;
                const activeCategory = document.querySelector('.navbtn.active')?.dataset.category || 'all';
                renderStories(activeCategory);
            });
        });

        document.querySelectorAll('.navbtn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelector('.navbtn.active').classList.remove('active');
                btn.classList.add('active');
                renderStories(btn.dataset.category);
            });
        });

        modal.querySelector('.modal-close-btn').addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });

        document.getElementById('playBtn').addEventListener('click', () => {
            const story = modal.story;
            const text = story.text[currentLanguage];
            if (AudioPlayer.isPlaying) {
                AudioPlayer.pause();
            } else {
                AudioPlayer.play(text, currentLanguage);
            }
        });

        document.getElementById('stopBtn').addEventListener('click', () => {
            AudioPlayer.stop();
        });

        AudioPlayer.audioElement.addEventListener('ended', () => {
            AudioPlayer._playNextChunk();
        });
    });

</script>
</body>
</html>
