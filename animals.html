<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kids Animal Fun ‚Äî ·ä•·äï·àµ·à≥·âµ</title>
    <style>
        :root {
            --accent: #ff6f61;
            --accent-2: #ffcc70;
            --bg: #fcfbf9;
            --card: #fff6e6;
            --muted: #666;
            --gap: 12px;
            --success: #4caf50;
            --fail: #f44336;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            margin: 0;
            font-family: Inter, "Comic Sans MS", system-ui, -apple-system, "Helvetica Neue", Arial;
            background: var(--bg);
            color: #222;
            line-height: 1.25;
        }

        header {
            background: linear-gradient(90deg, var(--accent), #ff8a80);
            color: white;
            padding: 10px 12px;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
            justify-content: space-between;
        }

        .brand {
            display: flex;
            gap: 8px;
            align-items: center;
            font-weight: 700;
        }

        .brand span {
            font-size: 20px;
        }

        nav {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        nav .navbtn {
            background: rgba(255, 255, 255, 0.12);
            border: none;
            color: white;
            padding: 6px 10px;
            border-radius: 999px;
            cursor: pointer;
            font-size: 14px;
        }

        nav .navbtn.small {
            padding: 4px 8px;
            font-size: 12px;
        }

        main {
            max-width: 1100px;
            margin: 16px auto;
            padding: 0 12px;
        }

        section {
            display: none;
        }

        section.active {
            display: block;
        }

        .controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 12px;
        }

        .controls .chip {
            background: var(--card);
            padding: 6px 8px;
            border-radius: 999px;
            border: 1px solid rgba(0, 0, 0, 0.06);
            font-size: 13px;
            cursor: pointer;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
            gap: var(--gap);
        }

        .card {
            background: var(--card);
            padding: 10px;
            border-radius: 14px;
            box-shadow: 0 6px 18px rgba(15, 15, 15, 0.06);
            text-align: center;
            border: 1px solid rgba(0, 0, 0, 0.03);
            cursor: pointer;
            position: relative;
        }

        .card .emoji {
            font-size: 80px;
            display: block;
            height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 8px 0;
        }

        .card h4 {
            margin: 6px 0 3px;
            font-size: 16px;
        }

        .card small {
            display: block;
            color: var(--muted);
            margin-bottom: 8px;
        }

        .card p {
            font-size: 13px;
            color: #333;
            margin: 6px 0 8px;
            min-height: 34px;
        }

        .card .btn {
            background: var(--accent);
            color: white;
            border: none;
            padding: 8px 10px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
        }

        .card .btn.alt {
            background: #eee;
            color: #444;
        }

        .panel {
            background: white;
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 6px 18px rgba(15, 15, 15, 0.05);
            margin-bottom: 12px;
            border: 1px solid rgba(0, 0, 0, 0.03);
        }

        .row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .center {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .feedback {
            min-height: 36px;
            font-weight: 600;
            font-size: 1.1rem;
            margin-top: 10px;
        }

        .confetti-piece {
            position: fixed;
            width: 8px;
            height: 12px;
            border-radius: 2px;
            z-index: 9999;
            opacity: 0.95;
            animation: confettiFly 1200ms ease-out forwards;
        }

        @keyframes confettiFly {
            0% {
                transform: translateY(0) rotate(0);
            }
            100% {
                transform: translateY(-80vh) rotate(720deg);
                opacity: 0;
            }
        }

        @media (max-width: 640px) {
            .card .emoji {
                height: 100px;
                font-size: 70px;
            }
            nav {
                gap: 6px;
            }
            nav .navbtn {
                padding: 6px 8px;
                font-size: 12px;
            }
        }

        .high-contrast {
            background: black;
            color: yellow;
        }

        .large-text {
            font-size: 1.15rem;
        }

        .choice {
            background: var(--accent-2);
            border-radius: 10px;
            padding: 8px 10px;
            border: none;
            cursor: pointer;
            margin: 6px;
            font-size: 14px;
        }

        .choice.wrong {
            background: #ffd8d8;
        }

        .choice.right {
            background: #b7f5bf;
        }

        .muted {
            color: #666;
            font-size: 13px;
        }

        .game-board {
            display: grid;
            gap: 10px;
            margin-top: 12px;
        }

        .memory-board {
            grid-template-columns: repeat(4, 1fr);
        }

        @media (max-width: 400px) {
            .memory-board {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        .memory-card {
            background-color: #ffcc80;
            border-radius: 8px;
            cursor: pointer;
            aspect-ratio: 1 / 1;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }

        .memory-card .face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
        }

        .memory-card .front {
            background-color: #ffcc80;
            color: #fff;
        }

        .memory-card .back {
            background-color: #fff6e6;
            transform: rotateY(180deg);
        }

        .memory-card.flipped {
            transform: rotateY(180deg);
        }

        .memory-card.matched {
            opacity: 1;
            pointer-events: none;
            box-shadow: 0 0 0 3px var(--success);
        }

        .baby-board {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .animal-selector {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .animal-option {
            font-size: 3rem;
            padding: 10px;
            border-radius: 10px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .animal-option.selected {
            border-color: var(--accent);
            background: var(--accent-2);
        }

        #sound-speaker {
            font-size: 4rem;
            cursor: pointer;
            margin: 10px;
            color: var(--accent);
            transition: transform 0.2s;
            position: relative;
        }

        #sound-speaker:hover {
            transform: scale(1.1);
        }

        .sound-choice {
            background: #fff;
            border: 2px solid #ddd;
            border-radius: 12px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s;
            flex-basis: 120px;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .sound-choice:hover {
            border-color: var(--accent);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .sound-choice.correct {
            background: #d4edda;
            border-color: var(--success);
        }

        .sound-choice.wrong {
            background: #f8d7da;
            border-color: var(--fail);
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 111, 97, 0.3);
            border-radius: 50%;
            border-top-color: var(--accent);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .sound-error {
            position: absolute;
            bottom: -20px;
            left: 0;
            width: 100%;
            color: var(--fail);
            font-size: 12px;
            text-align: center;
        }
    </style>
</head>
<body>
<header>
    <div class="brand"><span>ZooZoo</span><div class="muted">ü¶íüêòüêÖ ‚Ä¢ Kids</div></div>
    <nav>
        <button class="navbtn" onclick="show('animals')">üêÑ Animals</button>
        <button class="navbtn" onclick="show('games')">üéÆ Games</button>
        <button class="navbtn" onclick="show('quiz')">‚ùì Quiz</button>
        <button class="navbtn" onclick="show('resources')">üìö Resources</button>
        <button class="navbtn small" onclick="toggleContrast()">üåì</button>
        <button class="navbtn small" onclick="toggleText()">üî†</button>
    </nav>
</header>

<main>
    <section id="animals" class="active">
        <div class="controls">
            <div class="chip">Categories:</div>
            <button class="chip" onclick="filter('all')">All</button>
            <button class="chip" onclick="filter('farm')">Farm</button>
            <button class="chip" onclick="filter('wild')">Wild</button>
            <button class="chip" onclick="filter('birds')">Birds</button>
            <button class="chip" onclick="filter('sea')">Sea</button>
            <button class="chip" onclick="filter('insect')">Insects</button>
            <button class="chip" onclick="filter('pets')">Pets</button>
            <div style="flex:1"></div>
            <div class="muted">Tap an animal to hear its sound.</div>
        </div>
        <div id="animalGrid" class="grid"></div>
    </section>

    <section id="games">
        <div class="panel">
            <h3>üéØ Memory Match</h3>
            <div class="row">
                <button class="chip" onclick="startMemory(4)">4 Pairs</button>
                <button class="chip" onclick="startMemory(6)">6 Pairs</button>
                <button class="chip" onclick="startMemory(8)">8 Pairs</button>
            </div>
            <div id="memoryBoard" class="game-board memory-board"></div>
            <div id="memoryFeedback" class="feedback"></div>
        </div>
        <div class="panel">
            <h3>üë∂ Baby ‚Üí Parent Match</h3>
            <div class="row"><button class="chip" onclick="startBaby()">New Game</button></div>
            <div id="babyBoard" class="game-board baby-board"></div>
            <div id="babyFeedback" class="feedback"></div>
        </div>
        <div class="panel">
            <h3>üîä Sound Guess</h3>
            <div class="center">
                <div id="sound-speaker" onclick="soundGame.playSound()">üîä</div>
                <div id="soundChoices" class="row"></div>
            </div>
            <div id="soundFeedback" class="feedback center"></div>
        </div>
        <div class="panel">
            <h3>üòÇ Silly Fun</h3>
            <div class="row">
                <button class="chip" onclick="showJoke()">Tell me a joke</button>
                <button class="chip" onclick="sillyDance()">Make animals dance</button>
            </div>
            <div id="jokeBox" style="margin-top:8px; text-align: center;" class="muted"></div>
        </div>
    </section>

    <section id="quiz">
        <div class="panel">
            <h3>üèÜ Quiz ‚Äî Levels (3 levels)</h3>
            <div class="row">
                <button class="chip" onclick="setQuizLevel(1)">Level 1 (easy)</button>
                <button class="chip" onclick="setQuizLevel(2)">Level 2</button>
                <button class="chip" onclick="setQuizLevel(3)">Level 3</button>
                <button class="chip" onclick="resetQuiz()">Restart</button>
            </div>
            <div id="quizArea" style="margin-top:12px"></div>
            <div id="quizProgress" class="muted" style="margin-top:8px"></div>
            <div id="quizFeedback" class="feedback"></div>
        </div>
    </section>
    <section id="resources">
        <div class="panel">
            <h3>üìö Resources & Tips (Parents)</h3>
            <ul>
                <li>Keep sessions short (5‚Äì12 minutes) for ages 3‚Äì7.</li>
                <li>Use headphones at low volume for sound games.</li>
                <li>Encourage naming and repeating animal names in Amharic/English.</li>
            </ul>
        </div>
    </section>
</main>

<script>
    // --- SOUND SYSTEM ---
    const ttsCache = {};
    let activeAudio = null;

    document.addEventListener('click', function unlockAudio() {
        const silentSound = new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=');
        silentSound.play().catch(e => {});
    }, { once: true });

    function playAnimalSound(id, element) {
        if (activeAudio) {
            activeAudio.pause();
            activeAudio = null;
        }

        const item = animals.find(x => x.id === id);
        if (!item) return;

        // Clear previous indicators on the element
        if (element) {
            const existingLoader = element.querySelector('.loading');
            if(existingLoader) existingLoader.remove();
            const existingError = element.querySelector('.sound-error');
            if(existingError) existingError.remove();
        }

        const tryPlaySound = (soundUrl) => {
            if (!soundUrl) {
                const errorEl = document.createElement('div');
                errorEl.className = 'sound-error';
                errorEl.textContent = 'Sound not available';
                if (element) {
                    element.appendChild(errorEl);
                    setTimeout(() => { if (errorEl.parentElement) errorEl.remove(); }, 2000);
                }
                return;
            }

            // Show loading indicator
            let loadingEl;
            if (element) {
                loadingEl = document.createElement('div');
                loadingEl.className = 'loading';
                loadingEl.innerHTML = '<div class="loading-spinner"></div>';
                element.appendChild(loadingEl);
            }

            const audio = new Audio(soundUrl);
            activeAudio = audio;

            const removeIndicator = () => {
                if (loadingEl && loadingEl.parentElement) {
                    loadingEl.remove();
                }
            };

            audio.addEventListener('canplaythrough', removeIndicator);

            audio.addEventListener('error', () => {
                removeIndicator();
                const errorEl = document.createElement('div');
                errorEl.className = 'sound-error';
                errorEl.textContent = 'Could not play sound';
                if(element) {
                    element.appendChild(errorEl);
                    setTimeout(() => { if (errorEl.parentElement) errorEl.remove(); }, 2000);
                }
            });

            audio.play().catch(e => {
                audio.dispatchEvent(new Event('error'));
            });
        };

        tryPlaySound(item.sound);
    }

    // REMOVED THE NON-FUNCTIONAL speakAmharic(text) function.

    function speakEnglish(text) {
        if (activeAudio) {
            activeAudio.pause();
            activeAudio = null;
        }
        if (!text || text === 'null') return;

        // Use the Web Speech API for English
        if ('speechSynthesis' in window) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'en-US';
            utterance.rate = 0.8; // Slightly slower for kids
            speechSynthesis.speak(utterance);
        } else {
            // Fallback to Google TTS if Web Speech API is not available
            const audioUrl = `https://translate.google.com/translate_tts?ie=UTF-8&q=${encodeURIComponent(text)}&tl=en&client=tw-ob`;
            const audio = new Audio(audioUrl);
            activeAudio = audio;
            audio.play().catch(e => {});
        }
    }

    // --- DATA ---
    // Paths are corrected to use the required /audio/ prefix.
    const animals = [
        {id:'cow', name:'Cow', amh:'·àã·àù', cat:'farm', emoji:'üêÑ', desc:'Cows give milk.', sound:''},
        {id:'sheep', name:'Sheep', amh:'·â†·åç', cat:'farm', emoji:'üêë', desc:'Sheep give wool.', sound:''},
        {id:'pig', name:'Pig', amh:'·ä†·à≥·àõ', cat:'farm', emoji:'üêñ', desc:'Pigs are smart.', sound:''},
        {id:'horse', name:'Horse', amh:'·çà·à®·àµ', cat:'farm', emoji:'üêé', desc:'Fast and strong.', sound:''},
        {id:'chicken', name:'Chicken', amh:'·ã∂·àÆ', cat:'farm', emoji:'üêî', desc:'Makes eggs.', sound:'/audio/hen.mp3'},
        {id:'donkey', name:'Donkey', amh:'·ä†·àÖ·ã´', cat:'farm', emoji:'ü´è', desc:'Makes a "hee-haw" sound.', sound:'/audio/donkey.mp3'},
        {id:'dog', name:'Dog', amh:'·ãç·àª', cat:'pets', emoji:'üêï', desc:'Loyal friend.', sound:'/audio/dog.mp3'},
        {id:'cat', name:'Cat', amh:'·ãµ·àò·âµ', cat:'pets', emoji:'üêà', desc:'Purrs when happy.', sound:'/audio/cat.mp3'},
        {id:'lion', name:'Lion', amh:'·ä†·äï·â†·à≥', cat:'wild', emoji:'ü¶Å', desc:'King of the savanna.', sound:''},
        {id:'elephant', name:'Elephant', amh:'·ãù·àÜ·äï', cat:'wild', emoji:'üêò', desc:'Huge with trunk.', sound:'/audio/elephant.mp3'}, // CORRECTED PATH
        {id:'duck', name:'Duck', amh:'·ã≥·ä≠·ã¨', cat:'birds', emoji:'ü¶Ü', desc:'Quacks and swims.', sound:'/audio/birds.mp3'},
        {id:'owl', name:'Owl', amh:'·åâ·åâ·âµ', cat:'birds', emoji:'ü¶â', desc:'Nocturnal hunter.', sound:''},
        {id:'dolphin', name:'Dolphin', amh:'·ã∂·àç·çä·äï', cat:'sea', emoji:'üê¨', desc:'Smart swimmer.', sound:''},
        {id:'bee', name:'Bee', amh:'·äï·â•', cat:'insect', emoji:'üêù', desc:'Makes honey.', sound:''},
        {id:'rabbit', name:'Rabbit', amh:'·å•·äï·â∏·àç', cat:'pets', emoji:'üêá', desc:'Hops and cuddly.', sound:''},
        {id:'giraffe', name:'Giraffe', amh:'·âÄ·å≠·äî', cat:'wild', emoji:'ü¶í', desc:'Very tall.', sound:''},
        {id:'zebra', name:'Zebra', amh:'·ã®·àú·ã≥ ·ä†·àÖ·ã´', cat:'wild', emoji:'ü¶ì', desc:'Striped.', sound:''},
        {id:'duckling', name:'Duckling', amh:'·ã®·ã≥·ä≠·ã¨ ·å´·å©·âµ', cat:'birds', emoji:'üê§', desc:'Baby duck.', sound:''}
    ];

    /* ==========
        UI & RENDER FUNCTIONS
        ========== */
    const grid = document.getElementById('animalGrid');
    let currentFilter = 'all';

    function filter(cat) {
        currentFilter = cat;
        renderGrid();
    }

    function renderGrid() {
        grid.innerHTML = '';
        const list = animals.filter(a => currentFilter === 'all' ? true : a.cat === currentFilter);
        list.forEach(a => {
            const card = document.createElement('div');
            card.className = 'card';
            card.setAttribute('onclick', `playAnimalSound('${a.id}', this)`);
            card.innerHTML = `
                    <div class="emoji">${a.emoji}</div>
                    <h4>${escapeHtml(a.name)} <small>(${escapeHtml(a.amh)})</small></h4>
                    <p>${escapeHtml(a.desc)}</p>
                    <div class="row">
                        <button class="btn alt" onclick="speakEnglish('${a.name}'); event.stopPropagation();">üó£Ô∏è Speak English</button>
                    </div>
                `;
            grid.appendChild(card);
        });
    }

    function confettiBurst() {
        const colors = ['#ff6f61','#ffd166','#06d6a0','#4d96ff','#9b5de5'];
        for(let i = 0; i < 40; i++) {
            const c = document.createElement('div');
            c.className = 'confetti-piece';
            c.style.left = (10 + Math.random() * 80) + 'vw';
            c.style.top = (30 + Math.random() * 40) + 'vh';
            c.style.background = colors[Math.floor(Math.random() * colors.length)];
            c.style.transform = `rotate(${Math.random() * 360}deg)`;
            document.body.appendChild(c);
            setTimeout(() => c.remove(), 1500);
        }
    }

    function show(sectionId) {
        document.querySelectorAll('main section').forEach(s => s.classList.remove('active'));
        document.getElementById(sectionId).classList.add('active');
        window.scrollTo({top:0, behavior:'smooth'});
    }

    function toggleContrast() {
        document.body.classList.toggle('high-contrast');
    }

    function toggleText() {
        document.body.classList.toggle('large-text');
    }

    function shuffle(arr) {
        const a = [...arr];
        for(let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }

    function escapeHtml(s) {
        return (s || '').toString().replaceAll('<', '&lt;').replaceAll('>', '&gt;');
    }

    /* =================
        GAMES & QUIZ LOGIC
        ================= */
    const correctSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3');
    const wrongSound = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-wrong-answer-fail-notification-946.mp3');

    // --- Memory Match Game ---
    function startMemory(pairs = 4) {
        const board = document.getElementById('memoryBoard');
        const feedback = document.getElementById('memoryFeedback');
        board.innerHTML = '';
        feedback.textContent = '';
        let hasFlippedCard = false, lockBoard = false, firstCard, secondCard, matches = 0;

        let gridColumns = 4;
        if (pairs === 6) gridColumns = 3;
        if (pairs === 8) gridColumns = 4;

        board.style.gridTemplateColumns = `repeat(${gridColumns}, 1fr)`;

        const pool = shuffle(animals.map(a => a.emoji).filter((v, i, s) => s.indexOf(v) === i)).slice(0, pairs);
        const cards = shuffle([...pool, ...pool]);

        cards.forEach(emoji => {
            const card = document.createElement('div');
            card.className = 'memory-card';
            card.dataset.emoji = emoji;
            card.innerHTML = `<div class="face front">?</div><div class="face back">${emoji}</div>`;
            card.addEventListener('click', function() {
                if (lockBoard || this.classList.contains('flipped') || this.classList.contains('matched')) return;
                this.classList.add('flipped');
                if (!hasFlippedCard) {
                    hasFlippedCard = true;
                    firstCard = this;
                    return;
                }
                secondCard = this;
                lockBoard = true;
                if (firstCard.dataset.emoji === secondCard.dataset.emoji) {
                    correctSound.play();
                    feedback.textContent = "It's a Match! üéâ";
                    firstCard.classList.add('matched');
                    secondCard.classList.add('matched');
                    matches++;
                    if (matches === pairs) {
                        feedback.textContent = "You found them all! ü•≥";
                        confettiBurst();
                    }
                    resetBoard();
                } else {
                    wrongSound.play();
                    feedback.textContent = "Oops, not a match.";
                    setTimeout(() => {
                        firstCard.classList.remove('flipped');
                        secondCard.classList.remove('flipped');
                        resetBoard();
                    }, 1000);
                }
            });
            board.appendChild(card);
        });

        function resetBoard() {
            [hasFlippedCard, lockBoard] = [false, false];
            [firstCard, secondCard] = [null, null];
        }
    }

    // --- Baby to Parent Match ---
    function startBaby() {
        const board = document.getElementById("babyBoard");
        const fb = document.getElementById("babyFeedback");
        board.innerHTML = "";
        fb.textContent = "";

        let selected = {baby: null, parent: null};
        const pairs = [
            {baby: "üê•", parent: "üêî", name: "Chicken"},
            {baby: "üêÑ", parent: "üêÑ", name: "Cow"},
            {baby: "üêë", parent: "üêë", name: "Sheep"},
            {baby: "ü¶Å", parent: "ü¶Å", name: "Lion"},
            {baby: "üê∂", parent: "üêï", name: "Dog"},
            {baby: "üê±", parent: "üêà", name: "Cat"},
            {baby: "ü¶Ü", parent: "ü¶Ü", name: "Duck"}
        ];

        const gamePairs = shuffle(pairs).slice(0, 3);
        const babies = shuffle(gamePairs.map(p => p.baby));
        const parents = shuffle(gamePairs.map(p => p.parent));

        const babyContainer = document.createElement("div");
        babyContainer.className = "animal-selector";
        babies.forEach(baby => {
            const option = document.createElement("div");
            option.className = "animal-option";
            option.textContent = baby;
            option.dataset.animal = baby;
            option.onclick = () => selectAnimal("baby", option);
            babyContainer.appendChild(option);
        });

        const parentContainer = document.createElement("div");
        parentContainer.className = "animal-selector";
        parents.forEach(parent => {
            const option = document.createElement("div");
            option.className = "animal-option";
            option.textContent = parent;
            option.dataset.animal = parent;
            option.onclick = () => selectAnimal("parent", option);
            parentContainer.appendChild(option);
        });

        board.append(babyContainer, parentContainer);

        function selectAnimal(type, element) {
            if (element.style.opacity === "0.2") return;

            const container = type === "baby" ? babyContainer : parentContainer;
            container.querySelectorAll(".animal-option").forEach(opt => opt.classList.remove("selected"));
            element.classList.add("selected");
            selected[type] = element;

            if (selected.baby && selected.parent) {
                const isMatch = gamePairs.some(p =>
                    p.baby === selected.baby.dataset.animal &&
                    p.parent === selected.parent.dataset.animal
                );

                if (isMatch) {
                    correctSound.play();
                    fb.textContent = "Correct! You found a family! ‚ù§Ô∏è";
                    selected.baby.style.opacity = "0.2";
                    selected.parent.style.opacity = "0.2";
                    selected.baby.classList.remove("selected");
                    selected.parent.classList.remove("selected");
                    selected = {baby: null, parent: null};

                    const allMatched = Array.from(babyContainer.querySelectorAll('.animal-option'))
                        .every(opt => opt.style.opacity === "0.2");
                    if (allMatched) {
                        fb.textContent = "All families matched! Great job! üéâ";
                        confettiBurst();
                    }
                } else {
                    wrongSound.play();
                    fb.textContent = "That's not the right family, try again!";
                    setTimeout(() => {
                        selected.baby.classList.remove("selected");
                        selected.parent.classList.remove("selected");
                        selected = {baby: null, parent: null};
                    }, 800);
                }
            }
        }
    }

    // --- Sound Guess Game ---
    const soundGame = {
        choices: [],
        correctAnimal: null,
        board: document.getElementById("soundChoices"),
        feedback: document.getElementById("soundFeedback"),

        init: function() {
            this.feedback.textContent = "Click the speaker to listen!";
            this.board.innerHTML = "";

            const animalsWithSounds = animals.filter(a => a.sound);
            if (animalsWithSounds.length < 4) {
                this.board.innerHTML = "Not enough sounds for a new game.";
                return;
            }

            this.choices = shuffle(animalsWithSounds).slice(0, 4);
            this.correctAnimal = this.choices[Math.floor(Math.random() * this.choices.length)];

            this.choices.forEach(animal => {
                const choice = document.createElement("div");
                choice.className = "sound-choice";
                choice.textContent = animal.emoji;
                choice.style.fontSize = '3rem';
                choice.style.lineHeight = '1';
                choice.onclick = () => this.check(animal, choice);
                this.board.appendChild(choice);
            });
        },

        playSound: function() {
            if (this.correctAnimal) {
                const speakerElement = document.getElementById('sound-speaker');
                playAnimalSound(this.correctAnimal.id, speakerElement);
            }
        },

        check: function(animal, element) {
            if (animal.id === this.correctAnimal.id) {
                correctSound.play();
                element.classList.add("correct");
                this.feedback.textContent = `You got it! It's a ${animal.name}! üéâ`;
                setTimeout(() => this.init(), 2000);
            } else {
                wrongSound.play();
                element.classList.add("wrong");
                this.feedback.textContent = `Nope, that's a ${animal.name}. Try again!`;
                setTimeout(() => element.classList.remove("wrong"), 1000);
            }
        }
    };

    // --- Quiz Logic ---
    let quiz = {
        currentLevel: 1,
        questionIndex: 0,
        score: 0,
        levelData: {
            1: [
                {q: "What sound does the üêï dog make?", type: 'sound', correct: 'dog', options: ['dog', 'cat', 'pig', 'lion']},
                {q: "Which animal is **tall**?", type: 'match', correct: 'giraffe', options: ['duck', 'pig', 'giraffe', 'mouse']},
                {q: "Which animal says 'Moo'?", type: 'match', correct: 'cow', options: ['lion', 'cow', 'sheep', 'chicken']},
            ],
            2: [
                {q: "Which animal is found in the **sea**?", type: 'match', correct: 'dolphin', options: ['zebra', 'dolphin', 'horse', 'bee']},
                {q: "Which animal gives **honey**?", type: 'match', correct: 'bee', options: ['rabbit', 'chicken', 'bee', 'elephant']},
                {q: "What sound does the üêî chicken make?", type: 'sound', correct: 'chicken', options: ['cow', 'chicken', 'horse', 'donkey']},
            ],
            3: [
                {q: "Which animal is a nocturnal hunter?", type: 'match', correct: 'owl', options: ['owl', 'pig', 'rabbit', 'duck']},
                {q: "Which animal has stripes?", type: 'match', correct: 'zebra', options: ['elephant', 'zebra', 'cow', 'giraffe']},
                {q: "What sound does the üêò elephant make?", type: 'sound', correct: 'elephant', options: ['dog', 'elephant', 'cat', 'lion']},
            ]
        },

        start: function(level) {
            this.currentLevel = level;
            this.questionIndex = 0;
            this.score = 0;
            this.displayQuestion();
            document.getElementById('quizFeedback').textContent = '';
        },

        displayQuestion: function() {
            const area = document.getElementById('quizArea');
            const progress = document.getElementById('quizProgress');
            area.innerHTML = '';

            const questions = this.levelData[this.currentLevel];
            if (this.questionIndex >= questions.length) {
                this.showResults();
                return;
            }

            const currentQ = questions[this.questionIndex];
            const correctAnimal = animals.find(a => a.id === currentQ.correct);

            // Question Display
            const qEl = document.createElement('h4');
            qEl.textContent = `Question ${this.questionIndex + 1} of ${questions.length}: ${currentQ.q}`;
            area.appendChild(qEl);

            // Sound Game Integration
            if (currentQ.type === 'sound') {
                const soundBtn = document.createElement('div');
                soundBtn.id = 'quiz-sound-speaker';
                soundBtn.innerHTML = 'üîä Click to Hear Sound';
                soundBtn.className = 'btn';
                soundBtn.style.margin = '10px 0';
                soundBtn.style.cursor = 'pointer';
                soundBtn.onclick = () => {
                    playAnimalSound(currentQ.correct, soundBtn);
                };
                area.appendChild(soundBtn);
            } else if (currentQ.type === 'match') {
                const hintEl = document.createElement('div');
                hintEl.textContent = `Look for the ${correctAnimal.emoji}`;
                hintEl.style.fontSize = '2rem';
                hintEl.style.margin = '10px 0';
                hintEl.style.textAlign = 'center';
                area.appendChild(hintEl);
            }

            // Options Display
            const optionsRow = document.createElement('div');
            optionsRow.className = 'row';
            shuffle(currentQ.options).forEach(animalId => {
                const animal = animals.find(a => a.id === animalId);
                const button = document.createElement('button');
                button.className = 'choice';
                button.textContent = `${animal.emoji} ${animal.name}`;
                button.onclick = () => this.checkAnswer(animalId, currentQ.correct, button, optionsRow);
                optionsRow.appendChild(button);
            });
            area.appendChild(optionsRow);

            progress.textContent = `Level ${this.currentLevel} | Score: ${this.score}`;
        },

        checkAnswer: function(selected, correct, selectedElement, container) {
            const fb = document.getElementById('quizFeedback');
            container.querySelectorAll('.choice').forEach(btn => btn.disabled = true); // Disable all buttons

            if (selected === correct) {
                correctSound.play();
                selectedElement.classList.add('right');
                fb.textContent = "Correct! Great job! üéâ";
                this.score++;
                if (this.currentLevel === 3 && this.questionIndex === this.levelData[3].length - 1) {
                    confettiBurst(); // Final confetti
                }
            } else {
                wrongSound.play();
                selectedElement.classList.add('wrong');
                // Highlight correct answer
                container.querySelector(`.choice[onclick*="'${correct}'"]`).classList.add('right');
                const correctName = animals.find(a => a.id === correct).name;
                fb.textContent = `Incorrect. The correct answer was ${correctName}. üòî`;
            }

            this.questionIndex++;
            setTimeout(() => {
                fb.textContent = '';
                this.displayQuestion();
            }, 1500);
        },

        showResults: function() {
            const area = document.getElementById('quizArea');
            const progress = document.getElementById('quizProgress');
            const questions = this.levelData[this.currentLevel].length;
            area.innerHTML = `<h3 style="text-align:center;">Level ${this.currentLevel} Complete!</h3>
                              <p style="text-align:center;">You scored **${this.score}** out of **${questions}**.</p>`;
            progress.textContent = `Game Over! Press Restart to play again.`;
            document.getElementById('quizFeedback').textContent = this.score === questions ? "Perfect score! ü•≥" : "Try the next level!";
        }
    };

    function setQuizLevel(level) {
        if (quiz.levelData[level]) {
            quiz.start(level);
        }
    }

    function resetQuiz() {
        quiz.start(1);
    }

    // --- Silly Fun ---
    const jokes = [
        "Why did the elephant cross the road? Because it was the chicken's day off!",
        "What do you call a sleeping bull? A bulldozer!",
        "What animal is always ready for a fight? A boxing kangaroo!",
        "What has four wheels and flies? A garbage truck!",
        "Why don't scientists trust atoms? Because they make up everything!"
    ];
    let dancingAnimals = false;

    function showJoke() {
        const jokeBox = document.getElementById('jokeBox');
        const joke = jokes[Math.floor(Math.random() * jokes.length)];
        jokeBox.textContent = `üòÇ ${joke}`;
    }

    function sillyDance() {
        dancingAnimals = !dancingAnimals;
        const button = document.querySelector('.chip[onclick="sillyDance()"]');
        if (dancingAnimals) {
            button.textContent = "üõë Stop dancing";
            document.querySelectorAll('.card .emoji').forEach(e => {
                e.style.animation = "dance 0.5s infinite alternate";
            });
        } else {
            button.textContent = "Make animals dance";
            document.querySelectorAll('.card .emoji').forEach(e => {
                e.style.animation = "none";
            });
        }
    }

    // Add dance keyframes dynamically
    const styleSheet = document.createElement("style");
    styleSheet.innerHTML = `
        @keyframes dance {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(5deg) scale(1.05); }
            100% { transform: rotate(-5deg) scale(1); }
        }
    `;
    document.head.appendChild(styleSheet);


    // --- Initialization ---
    document.addEventListener('DOMContentLoaded', () => {
        renderGrid();
        startMemory(4); // Start memory game on load
        startBaby(); // Start baby game on load
        soundGame.init(); // Start sound game on load
        setQuizLevel(1); // Start quiz level 1 on load
    });
</script>
</body>
</html>
