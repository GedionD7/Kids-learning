<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Explorer - Amharic & English</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --accent: #2e7d32;
            --accent-light: #e8f5e9;
            --bg: #f8f9fa;
            --card: #ffffff;
            --muted: #6c757d;
            --gap: 16px;
            --success: #28a745;
            --fail: #dc3545;
            --border-color: #dee2e6;
            --warning: #ffc107;
            --info: #17a2b8;
            --easy: #28a745;
            --medium: #ffc107;
            --hard: #dc3545;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg);
            color: #212529;
            line-height: 1.5;
            font-size: 18px;
        }

        header {
            background: linear-gradient(135deg, var(--accent), #1b5e20);
            color: white;
            padding: 12px 16px;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .brand {
            font-weight: 700;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .brand i {
            font-size: 32px;
        }

        nav {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        nav .navbtn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 14px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 18px;
            font-weight: 600;
            transition: background-color 0.2s;
            white-space: nowrap;
        }
        nav .navbtn:hover { 
            background: rgba(255, 255, 255, 0.3); 
            transform: translateY(-2px);
        }

        main {
            max-width: 1200px;
            margin: 24px auto;
            padding: 0 16px;
        }

        section { display: none; }
        section.active { display: block; }

        .controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
            margin-bottom: 20px;
            padding: 12px;
            background: var(--card);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .controls .chip {
            background: #e9ecef;
            padding: 8px 14px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }
        .controls .chip:hover { background: var(--accent-light); }
        .controls .chip.active-filter { background: var(--accent); color: white; border-color: var(--accent); }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: var(--gap);
        }

        .card {
            background: var(--card);
            padding: 16px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            text-align: center;
            border: 1px solid var(--border-color);
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            position: relative;
            cursor: pointer;
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.1); }

        .family-display {
            width: 120px;
            height: 120px;
            margin-bottom: 12px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border-color);
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            background: var(--accent-light);
        }

        .card h4 { 
            margin: 8px 0 4px; 
            font-size: 22px;
            font-weight: 700;
        }
        .card small { 
            display: block; 
            color: var(--muted); 
            margin-bottom: 12px; 
            font-size: 20px;
            font-weight: 600;
        }

        .sound-buttons { 
            display: flex; 
            gap: 8px; 
            width: 100%; 
            flex-wrap: wrap;
        }
        .sound-buttons button {
            flex: 1;
            background: var(--accent);
            color: white;
            border: none;
            padding: 10px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            position: relative;
            min-height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
            min-width: 120px;
        }
        .sound-buttons button:hover { background-color: #1b5e20; }
        .sound-buttons .amharic-btn { background-color: var(--success); }
        .sound-buttons .amharic-btn:hover { background-color: #218838; }

        .panel {
            background: white;
            padding: 24px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
        }

        .panel h3 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel p {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .feedback { 
            min-height: 36px; 
            font-weight: 700;
            font-size: 22px;
            margin-top: 10px; 
            text-align: center; 
        }

        .memory-board { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .memory-card {
            background-color: var(--accent-light);
            border-radius: 8px;
            cursor: pointer;
            aspect-ratio: 1 / 1;
            display: flex;
            align-items: center;
            justify-content: center;
            transform-style: preserve-3d;
            transition: transform 0.5s;
        }
        .memory-card .family-display { 
            width: 80%; 
            height: 80%; 
            margin: 0;
            box-shadow: none;
        }
        .memory-card.flipped { background-color: #fff; transform: rotateY(180deg); }
        .memory-card.matched { opacity: 0.5; cursor: default; }
        .memory-card .front, .memory-card .back {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
        .memory-card .back { transform: rotateY(180deg); }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .search-box {
            padding: 12px 15px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            width: 100%;
            max-width: 300px;
            margin-left: auto;
            font-size: 18px;
        }
        
        .stats-bar {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            padding: 10px;
            background: var(--accent-light);
            border-radius: 8px;
            font-size: 20px;
            font-weight: 600;
        }
        
        .quiz-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .quiz-option {
            padding: 20px;
            background: var(--bg);
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.2s;
            font-size: 22px;
            font-weight: 600;
        }
        
        .quiz-option:hover {
            border-color: var(--accent);
        }
        
        .quiz-option.correct {
            background-color: var(--success);
            color: white;
        }
        
        .quiz-option.incorrect {
            background-color: var(--fail);
            color: white;
        }
        
        .progress-bar {
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: var(--success);
            border-radius: 5px;
            transition: width 0.3s;
        }
        
        .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: #ccc;
            transition: color 0.2s;
            z-index: 10;
        }
        
        .favorite-btn.active {
            color: gold;
        }
        
        .difficulty-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .difficulty-btn {
            padding: 12px 20px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            background: white;
            cursor: pointer;
            font-size: 20px;
            font-weight: 600;
        }
        
        .difficulty-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        
        .row {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 10px 0;
        }
        
        .center {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        
        /* Celebration effects */
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 2000;
        }
        
        .balloon {
            position: absolute;
            width: 40px;
            height: 50px;
            background: #ff6b6b;
            border-radius: 50%;
            animation: float 5s ease-in-out forwards;
            z-index: 1000;
            opacity: 0.9;
        }
        
        .balloon::before {
            content: "";
            position: absolute;
            bottom: -10px;
            left: 50%;
            width: 2px;
            height: 15px;
            background: #ccc;
            transform: translateX(-50%);
        }
        
        .balloon:nth-child(2n) {
            background: #4ecdc4;
        }
        
        .balloon:nth-child(3n) {
            background: #ffd166;
        }
        
        .balloon:nth-child(4n) {
            background: #2e7d32;
        }
        
        .balloon:nth-child(5n) {
            background: #06d6a0;
        }
        
        .rocket {
            position: absolute;
            font-size: 30px;
            animation: rocketLaunch 3s ease-in-out forwards;
            z-index: 1000;
        }
        
        .firework {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            box-shadow: 0 0 10px 2px;
            animation: fireworkExplode 1.5s ease-out forwards;
            z-index: 1000;
        }
        
        @keyframes float {
            0% {
                transform: translateY(0) rotate(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) rotate(20deg);
                opacity: 0;
            }
        }
        
        @keyframes rocketLaunch {
            0% {
                transform: translateY(100vh) rotate(45deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) rotate(45deg);
                opacity: 0;
            }
        }
        
        @keyframes fireworkExplode {
            0% {
                transform: translate(var(--x), var(--y)) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--x), var(--y)) scale(0);
                opacity: 0;
            }
        }
        
        /* Videos Section Styles */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .video-card {
            background: var(--card);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }

        .video-card:hover {
            transform: translateY(-5px);
        }

        .video-card h4 {
            margin-top: 0;
            margin-bottom: 15px;
            color: var(--accent);
            font-size: 20px;
            font-weight: 700;
            text-align: center;
            height: 40px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-camp: 2;
            -webkit-box-orient: vertical;
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            overflow: hidden;
            border-radius: 8px;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Quiz specific styles */
        .quiz-content {
            display: none;
        }
        
        .quiz-content.active {
            display: block;
        }
        
        .level-indicator {
            display: inline-block;
            padding: 8px 18px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 22px;
            margin-bottom: 10px;
        }
        
        .level-easy {
            background: var(--easy);
            color: white;
        }
        
        .level-medium {
            background: var(--medium);
            color: black;
        }
        
        .level-hard {
            background: var(--hard);
            color: white;
        }
        
        .quiz-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .quiz-navigation button {
            padding: 12px 24px;
            font-size: 20px;
            font-weight: 700;
        }
        
        .quiz-results {
            text-align: center;
            padding: 20px;
        }
        
        .quiz-results h3 {
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 28px;
            font-weight: 700;
        }
        
        .quiz-stats {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .quiz-stat {
            background: var(--accent-light);
            padding: 15px;
            border-radius: 10px;
            min-width: 100px;
        }
        
        .quiz-stat-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--accent);
        }
        
        .quiz-stat div {
            font-size: 18px;
            font-weight: 600;
        }
        
        .result-emoji {
            font-size: 50px;
            margin-bottom: 15px;
        }

        /* Family Tree Section */
        .family-tree {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
            position: relative;
        }

        .tree-level {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin: 20px 0;
            width: 100%;
        }

        .family-member {
            text-align: center;
            padding: 10px;
            position: relative;
        }

        .member-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: var(--accent-light);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-size: 30px;
            color: var(--accent);
            border: 2px solid var(--accent);
        }

        .member-name {
            font-weight: 600;
            font-size: 16px;
        }

        .tree-connector {
            height: 40px;
            width: 2px;
            background: var(--accent);
            margin: 0 auto;
        }

        /* Activities Section */
        .activities-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .activity-card {
            background: var(--card);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            text-align: center;
            transition: transform 0.2s;
            cursor: pointer;
        }

        .activity-card:hover {
            transform: translateY(-5px);
        }

        .activity-icon {
            font-size: 40px;
            margin-bottom: 10px;
            color: var(--accent);
        }

        .activity-card h4 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--accent);
        }

        .activity-card p {
            font-size: 16px;
            font-weight: 600;
        }

        /* Language toggle */
        .language-toggle {
            display: flex;
            gap: 10px;
            margin: 10px 0;
            justify-content: center;
        }

        .lang-btn {
            padding: 10px 20px;
            border-radius: 20px;
            border: 1px solid var(--border-color);
            background: white;
            cursor: pointer;
            font-size: 20px;
            font-weight: 700;
        }

        .lang-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* Question styling */
        .question {
            font-size: 26px;
            font-weight: 700;
            margin-bottom: 20px;
            text-align: center;
        }

        .question-number {
            font-size: 22px;
            font-weight: 600;
            color: var(--muted);
        }

        /* Modal for member details and activities */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 30px;
            cursor: pointer;
            color: var(--muted);
        }

        .modal-body {
            font-size: 18px;
            line-height: 1.6;
        }

        .member-detail-icon {
            font-size: 80px;
            text-align: center;
            margin: 20px 0;
        }

        /* Activity specific styles */
        .activity-instructions {
            background-color: var(--accent-light);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .activity-canvas {
            width: 100%;
            height: 300px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            margin: 15px 0;
            background-color: white;
            display: block;
        }

        .activity-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .activity-controls button {
            padding: 10px 15px;
            background-color: var(--accent);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

        .color-picker {
            display: flex;
            gap: 5px;
            margin: 10px 0;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .color-option.active {
            border-color: var(--accent);
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .video-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 20px;
            }
            
            nav {
                gap: 5px;
            }
            
            nav .navbtn {
                padding: 8px 12px;
                font-size: 16px;
            }
            
            .quiz-container {
                grid-template-columns: 1fr;
            }
            
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .family-display {
                width: 100px;
                height: 100px;
            }

            body {
                font-size: 16px;
            }

            .brand {
                font-size: 24px;
            }

            .panel h3 {
                font-size: 24px;
            }

            .question {
                font-size: 22px;
            }

            .activities-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .tree-level {
                gap: 20px;
            }
            
            .sound-buttons {
                flex-direction: column;
            }
            
            .sound-buttons button {
                width: 100%;
                font-size: 14px;
                min-height: 45px;
            }
        }

        @media (max-width: 576px) {
            .video-grid {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            nav {
                width: 100%;
                justify-content: center;
            }
            
            .grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .controls {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .search-box {
                margin-left: 0;
                max-width: 100%;
            }

            .activities-grid {
                grid-template-columns: 1fr;
            }

            .tree-level {
                flex-direction: column;
                gap: 10px;
            }

            .tree-connector {
                height: 20px;
                width: 2px;
            }
            
            .sound-buttons {
                flex-direction: row;
            }
            
            .sound-buttons button {
                font-size: 12px;
                min-height: 40px;
                padding: 8px;
            }
        }

        @media (max-width: 400px) {
            nav .navbtn {
                font-size: 14px;
                padding: 6px 10px;
            }
            
            .brand {
                font-size: 20px;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .quiz-navigation {
                flex-direction: column;
                gap: 10px;
            }
            
            .quiz-navigation button {
                width: 100%;
            }
            
            .memory-board {
                grid-template-columns: repeat(3, 1fr);
            }

            .lang-btn {
                font-size: 16px;
                padding: 8px 16px;
            }
            
            .sound-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="brand"><i class="fas fa-users"></i> Family Explorer</div>
        <nav>
            <button class="navbtn" onclick="show('members')"><i class="fas fa-user-friends"></i> Members</button>
            <button class="navbtn" onclick="show('tree')"><i class="fas fa-tree"></i> Family Tree</button>
            <button class="navbtn" onclick="show('activities')"><i class="fas fa-gamepad"></i> Activities</button>
            <button class="navbtn" onclick="show('games')"><i class="fas fa-puzzle-piece"></i> Games</button>
            <button class="navbtn" onclick="show('quiz')"><i class="fas fa-brain"></i> Quiz</button>
            <button class="navbtn" onclick="show('resources')"><i class="fas fa-video"></i> Videos</button>
        </nav>
    </header>

    <main>
        <!-- Language Toggle -->
        <div class="language-toggle">
            <button class="lang-btn active" id="englishBtn">English</button>
            <button class="lang-btn" id="amharicBtn">Amharic (·ä†·àõ·à≠·äõ)</button>
        </div>

        <!-- Family Members Section -->
        <section id="members" class="active">
            <div class="controls">
                <div class="chip">Filter:</div>
                <button class="chip active-filter" onclick="filterMembers('all', this)">All</button>
                <button class="chip" onclick="filterMembers('immediate', this)">Immediate</button>
                <button class="chip" onclick="filterMembers('extended', this)">Extended</button>
                <button class="chip" onclick="filterMembers('elders', this)">Elders</button>
                <input type="text" class="search-box" placeholder="Search family..." oninput="searchMembers(this.value)">
                <button class="chip" onclick="showOnlyFavoritesMembers()"><i class="fas fa-star"></i> Favorites</button>
            </div>
            <div id="membersGrid" class="grid"></div>
        </section>

        <!-- Family Tree Section -->
        <section id="tree">
            <div class="panel">
                <h3><i class="fas fa-tree"></i> Family Tree</h3>
                <p>See how family members are connected in a family tree!</p>
                
                <div class="family-tree">
                    <div class="tree-level">
                        <div class="family-member">
                            <div class="member-icon">üë¥</div>
                            <div class="member-name">Grandfather</div>
                            <div class="amharic-name">·ä†·ã´·âµ</div>
                        </div>
                        <div class="family-member">
                            <div class="member-icon">üëµ</div>
                            <div class="member-name">Grandmother</div>
                            <div class="amharic-name">·ä†·ã´·âµ</div>
                        </div>
                    </div>
                    
                    <div class="tree-connector"></div>
                    
                    <div class="tree-level">
                        <div class="family-member">
                            <div class="member-icon">üë®</div>
                            <div class="member-name">Father</div>
                            <div class="amharic-name">·ä†·â£·âµ</div>
                        </div>
                        <div class="family-member">
                            <div class="member-icon">üë©</div>
                            <div class="member-name">Mother</div>
                            <div class="amharic-name">·ä•·äì·âµ</div>
                        </div>
                    </div>
                    
                    <div class="tree-connector"></div>
                    
                    <div class="tree-level">
                        <div class="family-member">
                            <div class="member-icon">üë¶</div>
                            <div class="member-name">Brother</div>
                            <div class="amharic-name">·ãà·äï·ãµ·àù</div>
                        </div>
                        <div class="family-member">
                            <div class="member-icon">üëß</div>
                            <div class="member-name">Sister</div>
                            <div class="amharic-name">·ä•·àÖ·âµ</div>
                        </div>
                        <div class="family-member">
                            <div class="member-icon">üë∂</div>
                            <div class="member-name">Baby</div>
                            <div class="amharic-name">·àï·çÉ·äï</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Activities Section -->
        <section id="activities">
            <div class="panel">
                <h3><i class="fas fa-gamepad"></i> Family Activities</h3>
                <p>Fun activities to learn about families and relationships!</p>
                
                <div class="activities-grid">
                    <div class="activity-card" onclick="openActivity('drawFamily')">
                        <div class="activity-icon">üë®‚Äçüë©‚Äçüëß‚Äçüë¶</div>
                        <h4>Create Your Family</h4>
                        <p>Draw and label your own family members</p>
                    </div>
                    
                    <div class="activity-card" onclick="openActivity('photoAlbum')">
                        <div class="activity-icon">üì∏</div>
                        <h4>Family Photo Album</h4>
                        <p>Create a digital family photo album</p>
                    </div>
                    
                    <div class="activity-card" onclick="openActivity('rolePlay')">
                        <div class="activity-icon">üé≠</div>
                        <h4>Role Play</h4>
                        <p>Act out different family roles</p>
                    </div>
                    
                    <div class="activity-card" onclick="openActivity('familyStory')">
                        <div class="activity-icon">üìù</div>
                        <h4>Family Story</h4>
                        <p>Write a story about your family</p>
                    </div>
                    
                    <div class="activity-card" onclick="openActivity('familyPortrait')">
                        <div class="activity-icon">üé®</div>
                        <h4>Family Portrait</h4>
                        <p>Draw a picture of your family</p>
                    </div>
                    
                    <div class="activity-card" onclick="openActivity('familyPuzzle')">
                        <div class="activity-icon">üß©</div>
                        <h4>Family Puzzle</h4>
                        <p>Match family members with their roles</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Games Section -->
        <section id="games">
            <div class="panel">
                <h3><i class="fas fa-puzzle-piece"></i> Family Memory Match</h3>
                <div class="row">
                    <button class="chip" onclick="startFamilyMemory(4)">Easy (4 Pairs)</button>
                    <button class="chip" onclick="startFamilyMemory(6)">Medium (6 Pairs)</button>
                    <button class="chip" onclick="startFamilyMemory(8)">Hard (8 Pairs)</button>
                </div>
                <div class="stats-bar">
                    <span id="movesDisplay">Moves: 0</span>
                    <span id="matchesDisplay">Matches: 0/8</span>
                    <span id="memoryTimer">Time: 0s</span>
                </div>
                <div id="memoryBoard" class="memory-board"></div>
                <div id="memoryFeedback" class="feedback"></div>
            </div>
        </section>
        
        <!-- Quiz Section -->
        <section id="quiz">
            <div class="panel">
                <h3><i class="fas fa-brain"></i> Family Quiz</h3>
                <div class="difficulty-selector">
                    <button class="difficulty-btn active" data-level="easy" onclick="changeQuizDifficulty('easy')">Easy (Ages 3-5)</button>
                    <button class="difficulty-btn" data-level="medium" onclick="changeQuizDifficulty('medium')">Medium (Ages 5-7)</button>
                </div>
                
                <div class="progress-bar">
                    <div class="progress" id="quiz-progress" style="width: 0%"></div>
                </div>
                
                <div class="quiz-content active" id="quiz-content">
                    <div class="level-indicator level-easy" id="level-indicator">üü¢ Easy (Ages 3-5)</div>
                    
                    <div class="question" id="quiz-question">
                        <span class="question-number" id="question-number">Question 1/5</span><br>
                        <span id="question-text">Who is your mother's mother? üëµ</span>
                    </div>
                    
                    <div class="options" id="quiz-options">
                        <!-- Options will be populated by JavaScript -->
                    </div>
                    
                    <div class="quiz-navigation">
                        <button id="quiz-prev-btn" onclick="quizPrevious()" disabled>Previous</button>
                        <button id="quiz-next-btn" onclick="quizNext()">Next</button>
                    </div>
                </div>
                
                <div class="quiz-results" id="quiz-results" style="display: none;">
                    <div class="result-emoji" id="result-emoji">üéâ</div>
                    <h3>Quiz Completed!</h3>
                    <div class="score" id="quiz-score">Your score: 0/5</div>
                    
                    <div class="quiz-stats">
                        <div class="quiz-stat">
                            <div class="quiz-stat-value" id="correct-answers">0</div>
                            <div>Correct</div>
                        </div>
                        <div class="quiz-stat">
                            <div class="quiz-stat-value" id="incorrect-answers">0</div>
                            <div>Incorrect</div>
                        </div>
                    </div>
                    
                    <button onclick="restartQuiz()">Try Again</button>
                </div>
            </div>
        </section>
        
        <!-- Resources Section -->
        <section id="resources">
            <div class="panel">
                <h3><i class="fas fa-video"></i> Educational Videos</h3>
                <p>Watch these helpful videos to learn more about families:</p>
                
                <div class="video-grid">
                    <div class="video-card">
                        <h4>Family Members Song</h4>
                        <div class="video-container">
                            <iframe src="https://www.youtube.com/embed/d_WQEw13TCk" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                    </div>
                    
                    <div class="video-card">
                        <h4>Different Types of Families</h4>
                        <div class="video-container">
                            <iframe src="https://www.youtube.com/embed/CHkif8rE2xc" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                    </div>
                    
                    <div class="video-card">
                        <h4>Family Tree for Kids</h4>
                        <div class="video-container">
                            <iframe src="https://www.youtube.com/embed/4JZbe1w6vqU" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </div>
                    </div>
                    
                    <div class="video-card">
                        <h4>Family in Amharic</h4>
                        <div class="video-container">
                            <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f0f0f0; border-radius: 8px;">
                                <p>Video placeholder - Amharic content</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal for Member Details -->
    <div id="memberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="memberModalTitle">Family Member</h3>
                <button class="close-btn" onclick="closeModal('memberModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="member-detail-icon" id="memberModalIcon"></div>
                <div id="memberModalContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Activities -->
    <div id="activityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="activityModalTitle">Activity</h3>
                <button class="close-btn" onclick="closeModal('activityModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="activityModalContent">
                    <!-- Content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <div id="celebrationContainer" class="celebration"></div>

    <script>
        // --- LANGUAGE SYSTEM ---
        let currentLanguage = 'english';
        
        document.getElementById('englishBtn').addEventListener('click', function() {
            currentLanguage = 'english';
            document.getElementById('englishBtn').classList.add('active');
            document.getElementById('amharicBtn').classList.remove('active');
            updateContentLanguage();
        });
        
        document.getElementById('amharicBtn').addEventListener('click', function() {
            currentLanguage = 'amharic';
            document.getElementById('amharicBtn').classList.add('active');
            document.getElementById('englishBtn').classList.remove('active');
            updateContentLanguage();
        });
        
        function updateContentLanguage() {
            // Update section titles
            const sectionTitles = {
                'members': { english: 'Family Members', amharic: '·ã®·â§·â∞·à∞·â• ·ä†·â£·àã·âµ' },
                'tree': { english: 'Family Tree', amharic: '·ã®·â§·â∞·à∞·â• ·ãõ·çç' },
                'activities': { english: 'Activities', amharic: '·ä•·äï·âÖ·àµ·âÉ·à¥·ãé·âΩ' },
                'games': { english: 'Games', amharic: '·å®·ãã·â≥·ãé·âΩ' },
                'quiz': { english: 'Quiz', amharic: '·çà·â∞·äì' },
                'resources': { english: 'Videos', amharic: '·â™·ã≤·ãÆ·âΩ' }
            };
            
            document.querySelectorAll('h3').forEach(h3 => {
                const sectionId = h3.closest('section')?.id;
                if (sectionId && sectionTitles[sectionId]) {
                    h3.textContent = sectionTitles[sectionId][currentLanguage];
                }
            });
            
            // Update other text elements
            document.querySelectorAll('p').forEach(p => {
                if (p.textContent.includes('Filter:')) {
                    p.textContent = currentLanguage === 'english' ? 'Filter:' : '·àõ·å£·à™·ã´:';
                }
                if (p.textContent.includes('Search')) {
                    p.previousElementSibling.placeholder = currentLanguage === 'english' ? 'Search...' : '·çà·àç·åç...';
                }
            });
            
            // Reload content with updated language
            if (document.getElementById('members').classList.contains('active')) renderMembers();
            if (document.getElementById('quiz').classList.contains('active')) startQuiz();
        }

        // --- CELEBRATION SYSTEM ---
        function createBalloons(count) {
            const container = document.getElementById('celebrationContainer');
            
            for (let i = 0; i < count; i++) {
                const balloon = document.createElement('div');
                balloon.className = 'balloon';
                balloon.style.left = `${Math.random() * 100}%`;
                balloon.style.animationDuration = `${3 + Math.random() * 2}s`;
                container.appendChild(balloon);
                
                setTimeout(() => {
                    balloon.remove();
                }, 5000);
            }
        }

        function createRockets(count) {
            const container = document.getElementById('celebrationContainer');
            
            for (let i = 0; i < count; i++) {
                const rocket = document.createElement('div');
                rocket.className = 'rocket';
                rocket.innerHTML = 'üöÄ';
                rocket.style.left = `${Math.random() * 100}%`;
                rocket.style.animationDuration = `${2 + Math.random() * 1}s`;
                container.appendChild(rocket);
                
                setTimeout(() => {
                    rocket.remove();
                }, 3000);
            }
        }

        function createFireworks(count) {
            const container = document.getElementById('celebrationContainer');
            
            for (let i = 0; i < count; i++) {
                const firework = document.createElement('div');
                firework.className = 'firework';
                
                // Random color
                const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
                firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                firework.style.boxShadow = `0 0 10px 2px ${firework.style.backgroundColor}`;
                
                // Random position
                const x = (Math.random() - 0.5) * 200;
                const y = (Math.random() - 0.5) * 200;
                firework.style.setProperty('--x', `${x}px`);
                firework.style.setProperty('--y', `${y}px`);
                
                container.appendChild(firework);
                
                setTimeout(() => {
                    firework.remove();
                }, 1500);
            }
        }

        function celebrateSuccess(type) {
            switch(type) {
                case 'balloons':
                    createBalloons(15);
                    break;
                case 'rockets':
                    createRockets(8);
                    break;
                case 'fireworks':
                    createFireworks(20);
                    break;
                default:
                    // Random celebration
                    const celebrations = ['balloons', 'rockets', 'fireworks'];
                    const randomCelebration = celebrations[Math.floor(Math.random() * celebrations.length)];
                    celebrateSuccess(randomCelebration);
            }
        }

        // --- SOUND SYSTEM - Using Google TTS approach from first file ---
        let activeAudio = null;
        
        function showLoading(element) {
            if (!element.dataset.originalHTML) element.dataset.originalHTML = element.innerHTML;
            element.innerHTML = '<div class="loading-spinner"></div>';
            element.disabled = true;
        }
        
        function hideLoading(element) {
            if (element && element.dataset.originalHTML) {
                element.innerHTML = element.dataset.originalHTML;
                element.disabled = false;
            }
        }
        
        function speakTextViaGoogle(text, lang, element) {
            // Stop any currently playing audio
            if (activeAudio) {
                activeAudio.pause();
                const playingButton = document.querySelector('.loading-spinner')?.parentElement;
                if(playingButton && playingButton !== element) hideLoading(playingButton);
            }
            
            // Show loading state
            showLoading(element);
            
            // Use Google TTS API directly (same as first file)
            const encodedText = encodeURIComponent(text);
            const audioUrl = `https://translate.google.com/translate_tts?ie=UTF-8&tl=${lang}&client=tw-ob&q=${encodedText}`;
            
            activeAudio = new Audio(audioUrl);
            activeAudio.play().catch(e => {
                console.error("Audio error:", e);
                hideLoading(element);
                // Fallback to Web Speech API if Google TTS fails
                fallbackTTS(text, lang, element);
            });
            
            const onEnd = () => {
                hideLoading(element);
                activeAudio = null;
            };
            
            activeAudio.addEventListener('ended', onEnd);
            activeAudio.addEventListener('error', onEnd);
        }
        
        function fallbackTTS(text, lang, element) {
            const utterance = new SpeechSynthesisUtterance(text);
            
            if (lang === 'am') {
                utterance.lang = 'am-ET';
            } else {
                utterance.lang = 'en-US';
            }
            
            utterance.onend = function() {
                hideLoading(element);
                activeAudio = null;
            };
            
            utterance.onerror = function() {
                hideLoading(element);
                activeAudio = null;
            };
            
            speechSynthesis.speak(utterance);
            activeAudio = utterance;
        }

        // --- MODAL SYSTEM ---
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // --- NAVIGATION ---
        function show(sectionId) {
            document.querySelectorAll('section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            
            // Initialize section-specific content
            if (sectionId === 'members') renderMembers();
            if (sectionId === 'quiz') startQuiz();
        }

        // --- FAMILY MEMBERS DATA ---
        const familyData = [
            {
                id: 1,
                name: "Mother",
                amharic: "·ä•·äì·âµ",
                icon: "üë©",
                category: "immediate",
                description: "The female parent of a child. She takes care of you and loves you very much!",
                amharicDescription: "·ã®·àç·åÖ ·à¥·âµ ·ãà·àã·åÖ·ç¢ ·ä•·à∑ ·ã´·äï·â∞·äï ·ã≠·äï·ä®·â£·ä®·â£·àç ·ä•·äì ·â†·å£·àù ·ã≠·ãà·ãµ·àÉ·àç!"
            },
            {
                id: 2,
                name: "Father",
                amharic: "·ä†·â£·âµ",
                icon: "üë®",
                category: "immediate",
                description: "The male parent of a child. He protects the family and plays with you!",
                amharicDescription: "·ã®·àç·åÖ ·ãà·äï·ãµ ·ãà·àã·åÖ·ç¢ ·ä•·à± ·â§·â∞·à∞·â°·äï ·ã≠·å†·â•·âÉ·àç ·ä•·äì ·ä®·ä†·äï·â∞ ·åã·à≠ ·ã≠·å´·ãà·â≥·àç!"
            },
            {
                id: 3,
                name: "Brother",
                amharic: "·ãà·äï·ãµ·àù",
                icon: "üë¶",
                category: "immediate",
                description: "A male sibling. He might be older or younger than you. You can play together!",
                amharicDescription: "·ãà·äï·ãµ ·ãà·äï·ãµ·àù·ç¢ ·ä•·à± ·ä®·ä†·äï·â∞ ·ã®·àö·â†·àç·å• ·ãà·ã≠·àù ·ã´·äê·à∞ ·àä·àÜ·äï ·ã≠·âΩ·àã·àç·ç¢ ·ä†·â•·à®·ãç ·àò·å´·ãà·âµ ·âµ·âΩ·àã·àã·âΩ·àÅ!"
            },
            {
                id: 4,
                name: "Sister",
                amharic: "·ä•·àÖ·âµ",
                icon: "üëß",
                category: "immediate",
                description: "A female sibling. She might be older or younger than you. Sisters can be best friends!",
                amharicDescription: "·à¥·âµ ·ä•·àÖ·âµ·ç¢ ·ä•·à∑ ·ä®·ä†·äï·â∞ ÔøΩ·ã®·àö·â†·àç·å• ·ãà·ã≠·àù ·ã´·äê·à∞ ·àä·àÜ·äï ·ã≠·âΩ·àã·àç·ç¢ ·ä•·àÖ·â∂·âΩ ·ä•·åÖ·åç ·â†·å£·àù ·å•·à© ·åì·ã∞·äû·âΩ ·àä·àÜ·äë ·ã≠·âΩ·àã·àâ!"
            },
            {
                id: 5,
                name: "Grandmother",
                amharic: "·ä†·ã´·âµ",
                icon: "üëµ",
                category: "elders",
                description: "The mother of your parent. She tells wonderful stories and gives the best hugs!",
                amharicDescription: "·ã®·ãà·àã·åÖ·àΩ/·àÖ ·ä•·äì·âµ·ç¢ ·ä•·à∑ ·ä†·àµ·ã∞·äì·âÇ ·â≥·à™·äÆ·âΩ·äï ·âµ·äê·åç·à≠·àª·àà·âΩ ·ä•·äì ·ä•·åÖ·åç ·â†·å£·àù ·å•·à© ·àõ·åé·à™·ã´·ãé·âΩ·äï ·âµ·à∞·å£·àà·âΩ!"
            },
            {
                id: 6,
                name: "Grandfather",
                amharic: "·ä†·ã´·âµ",
                icon: "üë¥",
                category: "elders",
                description: "The father of your parent. He has wise advice and fun games to play!",
                amharicDescription: "·ã®·ãà·àã·åÖ·àΩ/·àÖ ·ä†·â£·âµ·ç¢ ·ä•·à± ·å•·â†·â• ·ã´·àà·ãç ·àù·ä≠·à≠ ·ä†·àà·ãç ·ä•·äì ·àà·àò·å´·ãà·âµ ·ä†·àµ·ã∞·à≥·âΩ ·å®·ãã·â≥·ãé·âΩ ·ä†·àâ·âµ!"
            },
            {
                id: 7,
                name: "Aunt",
                amharic: "·ä†·ä≠·àµ·âµ",
                icon: "üë©",
                category: "extended",
                description: "The sister of your parent. She's like an extra mom who brings fun presents!",
                amharicDescription: "·ã®·ãà·àã·åÖ·àΩ/·àÖ ·ä•·àÖ·âµ·ç¢ ·ä•·à∑ ·ä•·äï·ã∞ ·â∞·å®·àõ·à™ ·ä•·äì·âµ ·äê·âΩ ·ä•·äì ·ä†·àµ·ã∞·à≥·âΩ ·àµ·å¶·â≥·ãé·âΩ·äï ·âµ·àò·å£·àà·âΩ!"
            },
            {
                id: 8,
                name: "Uncle",
                amharic: "·ä†·åé·âµ",
                icon: "üë®",
                category: "extended",
                description: "The brother of your parent. He tells funny jokes and plays games with you!",
                amharicDescription: "·ã®·ãà·àã·åÖ·àΩ/·àÖ ·ãà·äï·ãµ·àù·ç¢ ·ä•·à± ·ä†·àµ·âÇ·äù ·âÄ·àç·ã∂·âΩ·äï ·ã≠·äê·åç·à≠·àÉ·àç ·ä•·äì ·ä®·ä†·äï·â∞ ·åã·à≠ ·å®·ãã·â≥·ãé·âΩ·äï ·ã≠·å´·ãà·â≥·àç!"
            },
            {
                id: 9,
                name: "Cousin",
                amharic: "·ã®·ä†·åé·âµ ·àç·åÖ",
                icon: "üßë",
                category: "extended",
                description: "The child of your aunt or uncle. They're like siblings you get to visit sometimes!",
                amharicDescription: "·ã®·ä†·ä≠·àµ·âµ·àΩ/·àÖ ·ãà·ã≠·àù ·ã®·ä†·åé·âµ·àΩ/·àÖ ·àç·åÖ·ç¢ ·ä•·äê·à± ·ä†·äï·ã≥·äï·ãµ ·åä·ãú ·àà·àò·åé·â•·äò·âµ ·ã®·àö·åà·äô ·ãà·äï·ãµ·àû·âΩ ·ãà·ã≠·àù ·ä•·àÖ·â∂·âΩ ·äì·â∏·ãç!"
            },
            {
                id: 10,
                name: "Baby",
                amharic: "·àï·çÉ·äï",
                icon: "üë∂",
                category: "immediate",
                description: "A very young child. Babies need lots of love, care, and gentle handling!",
                amharicDescription: "·â†·å£·àù ·ãà·å£·âµ ·àç·åÖ·ç¢ ·àï·çÉ·äì·âµ ·â•·ãô ·çç·âÖ·à≠·ç£ ·ä•·äï·ä≠·â•·ä´·â§ ·ä•·äì ·àà·àµ·àã·à≥ ·àò·ã´·ãù ·ã´·àµ·çà·àç·åã·â∏·ãã·àç!"
            }
        ];

        // --- FAVORITES SYSTEM ---
        let favoritesMembers = JSON.parse(localStorage.getItem('familyFavorites')) || [];

        function toggleFavoriteMember(memberId, event) {
            event.stopPropagation();
            const index = favoritesMembers.indexOf(memberId);
            if (index === -1) {
                favoritesMembers.push(memberId);
                celebrateSuccess('balloons');
            } else {
                favoritesMembers.splice(index, 1);
            }
            localStorage.setItem('familyFavorites', JSON.stringify(favoritesMembers));
            renderMembers();
        }

        function showOnlyFavoritesMembers() {
            const filterChips = document.querySelectorAll('#members .controls .chip');
            filterChips.forEach(chip => chip.classList.remove('active-filter'));
            filterChips[0].classList.add('active-filter');
            
            renderMembers(favoritesMembers.map(id => familyData.find(member => member.id === id)));
        }

        // --- MEMBERS RENDERING ---
        function renderMembers(filteredMembers = familyData) {
            const grid = document.getElementById('membersGrid');
            grid.innerHTML = '';
            
            filteredMembers.forEach(member => {
                const isFavorite = favoritesMembers.includes(member.id);
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <button class="favorite-btn ${isFavorite ? 'active' : ''}" onclick="toggleFavoriteMember(${member.id}, event)">
                        ${isFavorite ? '‚òÖ' : '‚òÜ'}
                    </button>
                    <div class="family-display">
                        <div style="font-size: 60px;">${member.icon}</div>
                    </div>
                    <h4>${currentLanguage === 'english' ? member.name : member.amharic}</h4>
                    <small>${currentLanguage === 'english' ? member.amharic : member.name}</small>
                    <div class="sound-buttons">
                        <button onclick="event.stopPropagation(); speakTextViaGoogle('${member.name}', 'en', this)">üîä ${currentLanguage === 'english' ? 'English' : '·ä•·äï·åç·àä·ãù·äõ'}</button>
                        <button class="amharic-btn" onclick="event.stopPropagation(); speakTextViaGoogle('${member.amharic}', 'am', this)">üîä ${currentLanguage === 'english' ? 'Amharic' : '·ä†·àõ·à≠·äõ'}</button>
                    </div>
                `;
                
                // Add click event to show member details
                card.addEventListener('click', () => showMemberDetails(member));
                grid.appendChild(card);
            });
        }

        // --- SHOW MEMBER DETAILS ---
        function showMemberDetails(member) {
            const modal = document.getElementById('memberModal');
            const title = document.getElementById('memberModalTitle');
            const icon = document.getElementById('memberModalIcon');
            const content = document.getElementById('memberModalContent');
            
            title.textContent = currentLanguage === 'english' ? member.name : member.amharic;
            icon.innerHTML = `<div style="font-size: 80px;">${member.icon}</div>`;
            
            content.innerHTML = `
                <p><strong>${currentLanguage === 'english' ? 'Name' : '·àµ·àù'}:</strong> ${currentLanguage === 'english' ? member.name : member.amharic}</p>
                <p><strong>${currentLanguage === 'english' ? 'Category' : '·àù·ãµ·â•'}:</strong> ${getCategoryName(member.category)}</p>
                <p><strong>${currentLanguage === 'english' ? 'Description' : '·àò·åç·àà·å´'}:</strong> ${currentLanguage === 'english' ? member.description : member.amharicDescription}</p>
            `;
            
            openModal('memberModal');
        }

        function getCategoryName(category) {
            const categories = {
                'immediate': { english: 'Immediate Family', amharic: '·âÖ·à≠·â• ·â§·â∞·à∞·â•' },
                'extended': { english: 'Extended Family', amharic: '·ãò·à≠·çç ·â§·â∞·à∞·â•' },
                'elders': { english: 'Elders', amharic: '·ä†·ãõ·ãç·äï·âµ' }
            };
            return categories[category][currentLanguage];
        }

        // --- ACTIVITIES SYSTEM ---
        function openActivity(activityId) {
            const modal = document.getElementById('activityModal');
            const title = document.getElementById('activityModalTitle');
            const content = document.getElementById('activityModalContent');
            
            // Set up activity based on ID
            switch(activityId) {
                case 'drawFamily':
                    title.textContent = currentLanguage === 'english' ? 'Draw Your Family' : '·â§·â∞·à∞·â•·àÖ·äï ·ä†·à≠·àù';
                    content.innerHTML = `
                        <div class="activity-instructions">
                            <p>${currentLanguage === 'english' 
                                ? 'Draw your family members in the space below. You can use different colors for each person!' 
                                : '·â§·â∞·à∞·â•·àÖ·äï ·ä†·â£·àã·âµ ·ä®·â≥·âΩ ·â£·àà·ãç ·â¶·â≥ ·àã·ã≠ ·ä†·à≠·àù·ç¢ ·àà·ä•·ã´·äï·ã≥·äï·ã± ·à∞·ãç ·ã®·â∞·àà·ã´·ã© ·âÄ·àà·àû·âΩ·äï ·àò·å†·âÄ·àù ·âµ·âΩ·àã·àà·àÖ!'}</p>
                        </div>
                        <canvas id="drawingCanvas" class="activity-canvas" width="500" height="300"></canvas>
                        <div class="color-picker">
                            <div class="color-option active" style="background-color: black;" onclick="selectColor('black')"></div>
                            <div class="color-option" style="background-color: red;" onclick="selectColor('red')"></div>
                            <div class="color-option" style="background-color: blue;" onclick="selectColor('blue')"></div>
                            <div class="color-option" style="background-color: green;" onclick="selectColor('green')"></div>
                            <div class="color-option" style="background-color: yellow;" onclick="selectColor('yellow')"></div>
                        </div>
                        <div class="activity-controls">
                            <button onclick="clearCanvas()">${currentLanguage === 'english' ? 'Clear' : '·ä†·åΩ·ã≥'}</button>
                            <button onclick="saveDrawing()">${currentLanguage === 'english' ? 'Save' : '·ä†·àµ·âÄ·àù·å•'}</button>
                        </div>
                    `;
                    initDrawingCanvas();
                    break;
                    
                case 'photoAlbum':
                    title.textContent = currentLanguage === 'english' ? 'Family Photo Album' : '·ã®·â§·â∞·à∞·â• ·çé·â∂ ·ä†·àç·â†·àù';
                    content.innerHTML = `
                        <div class="activity-instructions">
                            <p>${currentLanguage === 'english' 
                                ? 'Create your own family photo album! Add photos of your family members.' 
                                : '·ã®·à´·àµ·àÖ·äï ·ã®·â§·â∞·à∞·â• ·çé·â∂ ·ä†·àç·â†·àù ·çç·å†·à≠! ·ã®·â§·â∞·à∞·â•·àÖ·äï ÔøΩ·ä†·â£·àã·âµ ·çé·â∂·ãé·âΩ ·å®·àù·à≠·ç¢'}</p>
                        </div>
                        <div id="photoAlbum" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0;">
                            <div style="border: 2px dashed #ccc; height: 150px; display: flex; align-items: center; justify-content: center; cursor: pointer;" onclick="addPhoto()">
                                <div style="text-align: center;">
                                    <div style="font-size: 40px;">‚ûï</div>
                                    <div>${currentLanguage === 'english' ? 'Add Photo' : '·çé·â∂ ·å®·àù·à≠'}</div>
                                </div>
                            </div>
                        </div>
                        <div class="activity-controls">
                            <button onclick="printAlbum()">${currentLanguage === 'english' ? 'Print Album' : '·ä†·àç·â†·àù ·ä†·âµ·àù'}</button>
                        </div>
                    `;
                    break;
                    
                case 'rolePlay':
                    title.textContent = currentLanguage === 'english' ? 'Family Role Play' : '·ã®·â§·â∞·à∞·â• ·àö·äì ·àò·å´·ãà·âª';
                    content.innerHTML = `
                        <div class="activity-instructions">
                            <p>${currentLanguage === 'english' 
                                ? 'Choose a family member role to act out. What would they say or do?' 
                                : '·àà·àò·å´·ãà·âµ ·ã®·â§·â∞·à∞·â• ·ä†·â£·àç ·àö·äì ·àù·à®·å•·ç¢ ·ä•·äê·à± ·àù·äï ·ã≠·àâ ·äê·â†·à≠ ·ãà·ã≠·àù ·àù·äï ·ã≠·à∞·à© ·äê·â†·à≠?'}</p>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0;">
                            ${familyData.map(member => `
                                <div class="role-option" style="border: 1px solid #ddd; padding: 10px; border-radius: 8px; text-align: center; cursor: pointer;" onclick="selectRole('${member.name}')">
                                    <div style="font-size: 30px;">${member.icon}</div>
                                    <div>${currentLanguage === 'english' ? member.name : member.amharic}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div id="rolePlayArea" style="margin-top: 20px; display: none;">
                            <h4>${currentLanguage === 'english' ? 'Act out your role!' : '·àö·äì·àÖ·äï ·àÅ·äï!'}</h4>
                            <div id="rolePrompt" style="background: #f0f0f0; padding: 15px; border-radius: 8px; margin: 10px 0;"></div>
                            <button onclick="newRolePrompt()">${currentLanguage === 'english' ? 'New Scenario' : '·ä†·ã≤·àµ ·àÅ·äî·â≥'}</button>
                        </div>
                    `;
                    break;
                    
                case 'familyStory':
                    title.textContent = currentLanguage === 'english' ? 'Write a Family Story' : '·ã®·â§·â∞·à∞·â• ·â≥·à™·ä≠ ·åª·çç';
                    content.innerHTML = `
                        <div class="activity-instructions">
                            <p>${currentLanguage === 'english' 
                                ? 'Write a story about your family. You can include all your family members!' 
                                : '·àµ·àà ·â§·â∞·à∞·â•·àÖ ·â≥·à™·ä≠ ·åª·çç·ç¢ ·àÅ·àâ·äï·àù ·ã®·â§·â∞·à∞·â•·àÖ·äï ·ä†·â£·àã·âµ ·àõ·ä´·â∞·âµ ·âµ·âΩ·àã·àà·àÖ!'}</p>
                        </div>
                        <textarea id="storyText" style="width: 100%; height: 200px; padding: 10px; font-size: 16px; border: 1px solid #ddd; border-radius: 8px;" placeholder="${currentLanguage === 'english' ? 'Once upon a time...' : '·â†·å•·äï·âµ ·åä·ãú...'}"></textarea>
                        <div class="activity-controls">
                            <button onclick="saveStory()">${currentLanguage === 'english' ? 'Save Story' : '·â≥·à™·ä≠ ·ä†·àµ·âÄ·àù·å•'}</button>
                            <button onclick="readStory()">${currentLanguage === 'english' ? 'Read Aloud' : '·â†·ãµ·àù·çÖ ·ä†·äï·â•·â•'}</button>
                        </div>
                    `;
                    break;
                    
                case 'familyPortrait':
                    title.textContent = currentLanguage === 'english' ? 'Family Portrait' : '·ã®·â§·â∞·à∞·â• ·àù·àµ·àç';
                    content.innerHTML = `
                        <div class="activity-instructions">
                            <p>${currentLanguage === 'english' 
                                ? 'Draw a picture of your whole family together. Make everyone happy!' 
                                : '·àô·àâ ·â§·â∞·à∞·â•·àÖ·äï ·ä†·â•·à®·ãç ·ã´·àà·ãç·äï ·àù·àµ·àç ·ä†·à≠·àù·ç¢ ·àÅ·àâ·àù ·à∞·ãç ·ã∞·àµ·â∞·äõ ·ä†·ãµ·à≠·åç!'}</p>
                        </div>
                        <canvas id="portraitCanvas" class="activity-canvas" width="500" height="300"></canvas>
                        <div class="color-picker">
                            <div class="color-option active" style="background-color: black;" onclick="selectPortraitColor('black')"></div>
                            <div class="color-option" style="background-color: #8B4513;" onclick="selectPortraitColor('#8B4513')"></div>
                            <div class="color-option" style="background-color: #FFD700;" onclick="selectPortraitColor('#FFD700')"></div>
                            <div class="color-option" style="background-color: #FF69B4;" onclick="selectPortraitColor('#FF69B4')"></div>
                            <div class="color-option" style="background-color: #1E90FF;" onclick="selectPortraitColor('#1E90FF')"></div>
                        </div>
                        <div class="activity-controls">
                            <button onclick="clearPortrait()">${currentLanguage === 'english' ? 'Clear' : '·ä†·åΩ·ã≥'}</button>
                            <button onclick="savePortrait()">${currentLanguage === 'english' ? 'Save' : '·ä†·àµ·âÄ·àù·å•'}</button>
                        </div>
                    `;
                    initPortraitCanvas();
                    break;
                    
                case 'familyPuzzle':
                    title.textContent = currentLanguage === 'english' ? 'Family Puzzle' : '·ã®·â§·â∞·à∞·â• ·ä•·äï·âÜ·âÖ·àç·àΩ';
                    content.innerHTML = `
                        <div class="activity-instructions">
                            <p>${currentLanguage === 'english' 
                                ? 'Match the family members with their names and roles!' 
                                : '·ã®·â§·â∞·à∞·â• ·ä†·â£·àã·âµ·äï ·ä®·àµ·àõ·â∏·ãç ·ä•·äì ·ä®·àö·äì·â∏·ãç ·åã·à≠ ·ä†·ã´·ã≠·ãù!'}</p>
                        </div>
                        <div id="puzzleArea" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0;">
                            <div id="puzzlePieces" style="display: grid; grid-template-columns: 1fr 1fr; gap: 5px;">
                                ${familyData.map(member => `
                                    <div class="puzzle-piece" data-id="${member.id}" style="border: 1px solid #ddd; padding: 10px; border-radius: 8px; text-align: center; cursor: move;">
                                        <div style="font-size: 30px;">${member.icon}</div>
                                    </div>
                                `).join('')}
                            </div>
                            <div id="puzzleSlots" style="display: grid; grid-template-columns: 1fr; gap: 5px;">
                                ${familyData.map(member => `
                                    <div class="puzzle-slot" data-id="${member.id}" style="border: 2px dashed #ccc; padding: 10px; border-radius: 8px; text-align: center; min-height: 70px;">
                                        <div>${currentLanguage === 'english' ? member.name : member.amharic}</div>
                                        <small>${currentLanguage === 'english' ? member.description.split('.')[0] : member.amharicDescription.split('·ç¢')[0]}</small>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="activity-controls">
                            <button onclick="checkPuzzle()">${currentLanguage === 'english' ? 'Check Answers' : '·àò·àç·à∂·âΩ·äï ·àõ·à®·åã·åà·å´'}</button>
                            <button onclick="resetPuzzle()">${currentLanguage === 'english' ? 'Reset' : '·ä•·äï·ã∞·åà·äì ·åÄ·àù·à≠'}</button>
                        </div>
                        <div id="puzzleFeedback" style="margin-top: 10px; font-weight: bold;"></div>
                    `;
                    initPuzzle();
                    break;
            }
            
            openModal('activityModal');
        }

        // --- ACTIVITY IMPLEMENTATIONS ---
        
        // Drawing Activity
        let currentColor = 'black';
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let canvas, ctx;
        
        function initDrawingCanvas() {
            canvas = document.getElementById('drawingCanvas');
            ctx = canvas.getContext('2d');
            ctx.lineWidth = 3;
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.strokeStyle = currentColor;
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // Touch events for mobile
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', stopDrawing);
        }
        
        function selectColor(color) {
            currentColor = color;
            document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('active'));
            event.target.classList.add('active');
            ctx.strokeStyle = currentColor;
        }
        
        function startDrawing(e) {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            [lastX, lastY] = [e.clientX - rect.left, e.clientY - rect.top];
        }
        
        function draw(e) {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;
            
            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(currentX, currentY);
            ctx.stroke();
            [lastX, lastY] = [currentX, currentY];
        }
        
        function stopDrawing() {
            isDrawing = false;
        }
        
        function handleTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }
        
        function handleTouchMove(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            canvas.dispatchEvent(mouseEvent);
        }
        
        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
        
        function saveDrawing() {
            const dataURL = canvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.download = 'my-family-drawing.png';
            link.href = dataURL;
            link.click();
            alert(currentLanguage === 'english' ? 'Drawing saved!' : '·àµ·ãï·àâ ·â∞·âÄ·àù·åß·àç!');
        }
        
        // Portrait Activity (similar to drawing)
        let portraitColor = 'black';
        let portraitCanvas, portraitCtx;
        
        function initPortraitCanvas() {
            portraitCanvas = document.getElementById('portraitCanvas');
            portraitCtx = portraitCanvas.getContext('2d');
            portraitCtx.lineWidth = 3;
            portraitCtx.lineJoin = 'round';
            portraitCtx.lineCap = 'round';
            portraitCtx.strokeStyle = portraitColor;
            
            portraitCanvas.addEventListener('mousedown', startPortraitDrawing);
            portraitCanvas.addEventListener('mousemove', drawPortrait);
            portraitCanvas.addEventListener('mouseup', stopPortraitDrawing);
            portraitCanvas.addEventListener('mouseout', stopPortraitDrawing);
            
            // Touch events for mobile
            portraitCanvas.addEventListener('touchstart', handlePortraitTouchStart);
            portraitCanvas.addEventListener('touchmove', handlePortraitTouchMove);
            portraitCanvas.addEventListener('touchend', stopPortraitDrawing);
        }
        
        function selectPortraitColor(color) {
            portraitColor = color;
            document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('active'));
            event.target.classList.add('active');
            portraitCtx.strokeStyle = portraitColor;
        }
        
        function startPortraitDrawing(e) {
            isDrawing = true;
            const rect = portraitCanvas.getBoundingClientRect();
            [lastX, lastY] = [e.clientX - rect.left, e.clientY - rect.top];
        }
        
        function drawPortrait(e) {
            if (!isDrawing) return;
            const rect = portraitCanvas.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;
            
            portraitCtx.beginPath();
            portraitCtx.moveTo(lastX, lastY);
            portraitCtx.lineTo(currentX, currentY);
            portraitCtx.stroke();
            [lastX, lastY] = [currentX, currentY];
        }
        
        function stopPortraitDrawing() {
            isDrawing = false;
        }
        
        function handlePortraitTouchStart(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousedown', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            portraitCanvas.dispatchEvent(mouseEvent);
        }
        
        function handlePortraitTouchMove(e) {
            e.preventDefault();
            const touch = e.touches[0];
            const mouseEvent = new MouseEvent('mousemove', {
                clientX: touch.clientX,
                clientY: touch.clientY
            });
            portraitCanvas.dispatchEvent(mouseEvent);
        }
        
        function clearPortrait() {
            portraitCtx.clearRect(0, 0, portraitCanvas.width, portraitCanvas.height);
        }
        
        function savePortrait() {
            const dataURL = portraitCanvas.toDataURL('image/png');
            const link = document.createElement('a');
            link.download = 'my-family-portrait.png';
            link.href = dataURL;
            link.click();
            alert(currentLanguage === 'english' ? 'Portrait saved!' : '·àù·àµ·àâ ·â∞·âÄ·àù·åß·àç!');
        }
        
        // Photo Album Activity
        function addPhoto() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        const img = document.createElement('img');
                        img.src = event.target.result;
                        img.style.width = '100%';
                        img.style.height = '150px';
                        img.style.objectFit = 'cover';
                        img.style.borderRadius = '8px';
                        
                        const photoContainer = document.createElement('div');
                        photoContainer.style.position = 'relative';
                        photoContainer.appendChild(img);
                        
                        const removeBtn = document.createElement('button');
                        removeBtn.textContent = '√ó';
                        removeBtn.style.position = 'absolute';
                        removeBtn.style.top = '5px';
                        removeBtn.style.right = '5px';
                        removeBtn.style.background = 'red';
                        removeBtn.style.color = 'white';
                        removeBtn.style.border = 'none';
                        removeBtn.style.borderRadius = '50%';
                        removeBtn.style.width = '25px';
                        removeBtn.style.height = '25px';
                        removeBtn.style.cursor = 'pointer';
                        removeBtn.onclick = function() {
                            photoContainer.remove();
                        };
                        photoContainer.appendChild(removeBtn);
                        
                        document.getElementById('photoAlbum').appendChild(photoContainer);
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }
        
        function printAlbum() {
            alert(currentLanguage === 'english' ? 'Your photo album would be printed!' : '·ã®·ä†·äï·â∞ ·çé·â∂ ·ä†·àç·â†·àù ·ã≠·â≥·â∞·àõ·àç!');
        }
        
        // Role Play Activity
        function selectRole(role) {
            document.getElementById('rolePlayArea').style.display = 'block';
            newRolePrompt();
        }
        
        function newRolePrompt() {
            const prompts = currentLanguage === 'english' ? [
                "What would you say at the dinner table?",
                "How would you help another family member?",
                "What would you do on a family vacation?",
                "How would you celebrate a birthday?",
                "What would you say to comfort someone who is sad?"
            ] : [
                "·â†·ãµ·à´·à≠ ·àõ·ãï·ä®·àç ·àã·ã≠ ·àù·äï ·âµ·àã·àà·àÖ?",
                "·àå·àã ·ã®·â§·â∞·à∞·â• ·ä†·â£·àç ·ä•·äï·ã¥·âµ ·âµ·à®·ã≥·àà·àÖ?",
                "·â†·â§·â∞·à∞·â• ·â†·ãï·à®·çç·âµ ·åä·ãú ·àù·äï ·âµ·à∞·à´·àà·àÖ?",
                "·ã®·àç·ã∞·âµ ·â†·ãì·àç ·ä•·äï·ã¥·âµ ·âµ·ä®·â•·à´·àà·àÖ?",
                "·àà·àö·ã´·ãù·äï ·à∞·ãç ·àà·àõ·åΩ·äì·äì·âµ ·àù·äï ·âµ·àã·àà·àÖ?"
            ];
            
            const randomPrompt = prompts[Math.floor(Math.random() * prompts.length)];
            document.getElementById('rolePrompt').textContent = randomPrompt;
        }
        
        // Family Story Activity
        function saveStory() {
            const storyText = document.getElementById('storyText').value;
            if (storyText.trim() === '') {
                alert(currentLanguage === 'english' ? 'Please write a story first!' : '·ä•·â£·ä≠·àÖ ·àò·åÄ·àò·à™·ã´ ·â≥·à™·ä≠ ·åª·çç!');
                return;
            }
            
            const blob = new Blob([storyText], { type: 'text/plain' });
            const link = document.createElement('a');
            link.download = 'my-family-story.txt';
            link.href = URL.createObjectURL(blob);
            link.click();
            alert(currentLanguage === 'english' ? 'Story saved!' : '·â≥·à™·ä© ·â∞·âÄ·àù·åß·àç!');
        }
        
        function readStory() {
            const storyText = document.getElementById('storyText').value;
            if (storyText.trim() === '') {
                alert(currentLanguage === 'english' ? 'Please write a story first!' : '·ä•·â£·ä≠·àÖ ·àò·åÄ·àò·à™·ã´ ·â≥·à™·ä≠ ·åª·çç!');
                return;
            }
            
            const utterance = new SpeechSynthesisUtterance(storyText);
            speechSynthesis.speak(utterance);
        }
        
        // Family Puzzle Activity
        function initPuzzle() {
            const pieces = document.querySelectorAll('.puzzle-piece');
            pieces.forEach(piece => {
                piece.setAttribute('draggable', 'true');
                piece.addEventListener('dragstart', handleDragStart);
            });
            
            const slots = document.querySelectorAll('.puzzle-slot');
            slots.forEach(slot => {
                slot.addEventListener('dragover', handleDragOver);
                slot.addEventListener('drop', handleDrop);
            });
        }
        
        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.id);
        }
        
        function handleDragOver(e) {
            e.preventDefault();
        }
        
        function handleDrop(e) {
            e.preventDefault();
            const id = e.dataTransfer.getData('text/plain');
            const piece = document.querySelector(`.puzzle-piece[data-id="${id}"]`);
            const slot = e.target.closest('.puzzle-slot');
            
            if (slot && !slot.querySelector('.puzzle-piece')) {
                slot.appendChild(piece);
                piece.style.margin = '0';
            }
        }
        
        function checkPuzzle() {
            let correct = 0;
            const slots = document.querySelectorAll('.puzzle-slot');
            
            slots.forEach(slot => {
                const piece = slot.querySelector('.puzzle-piece');
                if (piece && piece.dataset.id === slot.dataset.id) {
                    correct++;
                    slot.style.borderColor = 'var(--success)';
                } else {
                    slot.style.borderColor = 'var(--fail)';
                }
            });
            
            const feedback = document.getElementById('puzzleFeedback');
            if (correct === familyData.length) {
                feedback.textContent = currentLanguage === 'english' 
                    ? 'Congratulations! All matches are correct!' 
                    : '·ä•·äï·ä≥·äï ·ã∞·àµ ·ä†·àà·àÖ! ·àÅ·àâ·àù ·àò·àç·à∂·âΩ ·âµ·ä≠·ä≠·àç ·äì·â∏·ãç!';
                feedback.style.color = 'var(--success)';
                celebrateSuccess('fireworks');
            } else {
                feedback.textContent = currentLanguage === 'english' 
                    ? `${correct}/${familyData.length} correct. Keep trying!` 
                    : `${correct}/${familyData.length} ·âµ·ä≠·ä≠·àç·ç¢ ·àà·àò·àû·ä®·à≠ ·â∞·å†·äï·âÄ·âÖ!`;
                feedback.style.color = 'var(--fail)';
            }
        }
        
        function resetPuzzle() {
            const piecesContainer = document.getElementById('puzzlePieces');
            const slots = document.querySelectorAll('.puzzle-slot');
            
            // Move all pieces back to pieces container
            document.querySelectorAll('.puzzle-piece').forEach(piece => {
                piecesContainer.appendChild(piece);
            });
            
            // Reset slot borders
            slots.forEach(slot => {
                slot.style.borderColor = '#ccc';
            });
            
            // Clear feedback
            document.getElementById('puzzleFeedback').textContent = '';
        }

        // --- FILTERING AND SEARCH ---
        function filterMembers(category, element) {
            document.querySelectorAll('#members .controls .chip').forEach(chip => {
                chip.classList.remove('active-filter');
            });
            element.classList.add('active-filter');
            
            let filteredMembers = familyData;
            if (category !== 'all') {
                filteredMembers = familyData.filter(member => member.category === category);
            }
            
            renderMembers(filteredMembers);
        }

        function searchMembers(query) {
            if (!query) {
                renderMembers();
                return;
            }
            
            const filteredMembers = familyData.filter(member => 
                member.name.toLowerCase().includes(query.toLowerCase()) ||
                member.amharic.toLowerCase().includes(query.toLowerCase())
            );
            
            renderMembers(filteredMembers);
        }

        // --- MEMORY GAME ---
        let memoryGame = {
            cards: [],
            flippedCards: [],
            matchedPairs: 0,
            totalPairs: 0,
            moves: 0,
            timer: null,
            timeElapsed: 0,
            gameStarted: false,
            
            init: function(pairs) {
                this.totalPairs = pairs;
                this.matchedPairs = 0;
                this.moves = 0;
                this.timeElapsed = 0;
                this.flippedCards = [];
                this.gameStarted = false;
                
                // Clear any existing timer
                if (this.timer) clearInterval(this.timer);
                
                // Create card pairs
                this.cards = [];
                const selectedMembers = [];
                
                // Select random family members
                while (selectedMembers.length < pairs) {
                    const randomMember = familyData[Math.floor(Math.random() * familyData.length)];
                    if (!selectedMembers.includes(randomMember)) {
                        selectedMembers.push(randomMember);
                    }
                }
                
                // Create pairs
                selectedMembers.forEach(member => {
                    this.cards.push({...member, id: member.id * 2});
                    this.cards.push({...member, id: member.id * 2 + 1});
                });
                
                // Shuffle cards
                this.cards.sort(() => Math.random() - 0.5);
                
                this.renderBoard();
                this.updateDisplay();
            },
            
            renderBoard: function() {
                const board = document.getElementById('memoryBoard');
                board.innerHTML = '';
                
                // Adjust grid based on number of pairs
                if (this.totalPairs <= 4) {
                    board.style.gridTemplateColumns = 'repeat(4, 1fr)';
                } else if (this.totalPairs <= 6) {
                    board.style.gridTemplateColumns = 'repeat(4, 1fr)';
                } else {
                    board.style.gridTemplateColumns = 'repeat(4, 1fr)';
                }
                
                this.cards.forEach(card => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'memory-card';
                    cardElement.dataset.id = card.id;
                    cardElement.innerHTML = `
                        <div class="front">?</div>
                        <div class="back">
                            <div class="family-display">
                                <div style="font-size: 40px;">${card.icon}</div>
                            </div>
                        </div>
                    `;
                    cardElement.addEventListener('click', () => this.flipCard(cardElement, card));
                    board.appendChild(cardElement);
                });
            },
            
            flipCard: function(cardElement, card) {
                // Don't allow flipping if already flipped or matched
                if (cardElement.classList.contains('flipped') || 
                    cardElement.classList.contains('matched') ||
                    this.flippedCards.length >= 2) {
                    return;
                }
                
                // Start timer on first move
                if (!this.gameStarted) {
                    this.startTimer();
                    this.gameStarted = true;
                }
                
                cardElement.classList.add('flipped');
                this.flippedCards.push({element: cardElement, card: card});
                
                if (this.flippedCards.length === 2) {
                    this.moves++;
                    this.checkMatch();
                }
                
                this.updateDisplay();
            },
            
            checkMatch: function() {
                const card1 = this.flippedCards[0];
                const card2 = this.flippedCards[1];
                
                if (card1.card.name === card2.card.name) {
                    // Match found
                    setTimeout(() => {
                        card1.element.classList.add('matched');
                        card2.element.classList.add('matched');
                        this.flippedCards = [];
                        this.matchedPairs++;
                        
                        if (this.matchedPairs === this.totalPairs) {
                            this.endGame();
                        }
                        
                        this.updateDisplay();
                    }, 500);
                } else {
                    // No match
                    setTimeout(() => {
                        card1.element.classList.remove('flipped');
                        card2.element.classList.remove('flipped');
                        this.flippedCards = [];
                        this.updateDisplay();
                    }, 1000);
                }
            },
            
            startTimer: function() {
                this.timer = setInterval(() => {
                    this.timeElapsed++;
                    this.updateDisplay();
                }, 1000);
            },
            
            updateDisplay: function() {
                document.getElementById('movesDisplay').textContent = `Moves: ${this.moves}`;
                document.getElementById('matchesDisplay').textContent = `Matches: ${this.matchedPairs}/${this.totalPairs}`;
                document.getElementById('memoryTimer').textContent = `Time: ${this.timeElapsed}s`;
            },
            
            endGame: function() {
                clearInterval(this.timer);
                const feedback = document.getElementById('memoryFeedback');
                feedback.textContent = `Congratulations! You completed the game in ${this.moves} moves and ${this.timeElapsed} seconds!`;
                feedback.style.color = 'var(--success)';
                celebrateSuccess('rockets');
            }
        };

        function startFamilyMemory(pairs) {
            memoryGame.init(pairs);
        }

        // --- QUIZ SYSTEM ---
        let currentQuiz = {
            difficulty: 'easy',
            questions: [],
            currentQuestionIndex: 0,
            score: 0,
            userAnswers: []
        };

        // Simplified family-themed questions for kids
        const quizQuestions = {
            easy: [
                {
                    question: "Who is your mother's mother? üëµ",
                    options: ["Sister", "Grandmother", "Aunt", "Cousin"],
                    correct: 1
                },
                {
                    question: "Who is your father's brother? üë®",
                    options: ["Uncle", "Grandfather", "Cousin", "Brother"],
                    correct: 0
                },
                {
                    question: "Who is your parent's child? üë¶",
                    options: ["Cousin", "Sister/Brother", "Aunt", "Grandparent"],
                    correct: 1
                },
                {
                    question: "Who is your mother's sister? üë©",
                    options: ["Cousin", "Aunt", "Grandmother", "Sister"],
                    correct: 1
                },
                {
                    question: "Who is your sibling's child? üë∂",
                    options: ["Cousin", "Niece/Nephew", "Sister", "Brother"],
                    correct: 1
                }
            ],
            medium: [
                {
                    question: "What do you call your father's father?",
                    options: ["Uncle", "Grandfather", "Cousin", "Brother"],
                    correct: 1
                },
                {
                    question: "What is the relationship between you and your aunt's child?",
                    options: ["Siblings", "Cousins", "Aunt/Nephew", "Grandparent"],
                    correct: 1
                },
                {
                    question: "Who is your mother's brother to you?",
                    options: ["Cousin", "Uncle", "Brother", "Grandfather"],
                    correct: 1
                },
                {
                    question: "What do you call your sister's daughter?",
                    options: ["Cousin", "Sister", "Niece", "Aunt"],
                    correct: 2
                },
                {
                    question: "Who is your grandmother's daughter to you?",
                    options: ["Aunt", "Mother", "Sister", "Cousin"],
                    correct: 1
                }
            ]
        };

        function changeQuizDifficulty(level) {
            currentQuiz.difficulty = level;
            
            // Update UI
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`.difficulty-btn[data-level="${level}"]`).classList.add('active');
            
            // Update level indicator
            const indicator = document.getElementById('level-indicator');
            indicator.className = `level-indicator level-${level}`;
            
            let levelText = '';
            if (level === 'easy') levelText = 'Easy (Ages 3-5)';
            else levelText = 'Medium (Ages 5-7)';
            
            indicator.textContent = `${level === 'easy' ? 'üü¢' : 'üü°'} ${levelText}`;
            
            // Restart quiz with new difficulty
            startQuiz();
        }

        function startQuiz() {
            currentQuiz.questions = [...quizQuestions[currentQuiz.difficulty]];
            currentQuiz.currentQuestionIndex = 0;
            currentQuiz.score = 0;
            currentQuiz.userAnswers = [];
            
            // Shuffle questions
            currentQuiz.questions.sort(() => Math.random() - 0.5);
            
            displayQuestion();
            updateProgressBar();
            
            // Show quiz content, hide results
            document.getElementById('quiz-content').style.display = 'block';
            document.getElementById('quiz-results').style.display = 'none';
        }

        function displayQuestion() {
            const question = currentQuiz.questions[currentQuiz.currentQuestionIndex];
            const questionNumber = currentQuiz.currentQuestionIndex + 1;
            const totalQuestions = currentQuiz.questions.length;
            
            document.getElementById('question-number').textContent = `Question ${questionNumber}/${totalQuestions}`;
            document.getElementById('question-text').textContent = question.question;
            
            const optionsContainer = document.getElementById('quiz-options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'quiz-option';
                optionElement.textContent = option;
                optionElement.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(optionElement);
            });
            
            // Update navigation buttons
            document.getElementById('quiz-prev-btn').disabled = currentQuiz.currentQuestionIndex === 0;
            document.getElementById('quiz-next-btn').textContent = 
                currentQuiz.currentQuestionIndex === totalQuestions - 1 ? 'Finish' : 'Next';
        }

        function selectAnswer(answerIndex) {
            const question = currentQuiz.questions[currentQuiz.currentQuestionIndex];
            const options = document.querySelectorAll('.quiz-option');
            
            // Disable all options
            options.forEach(opt => {
                opt.onclick = null;
            });
            
            // Mark correct/incorrect
            options[answerIndex].classList.add(answerIndex === question.correct ? 'correct' : 'incorrect');
            options[question.correct].classList.add('correct');
            
            // Record answer
            currentQuiz.userAnswers[currentQuiz.currentQuestionIndex] = answerIndex;
            if (answerIndex === question.correct) {
                currentQuiz.score++;
                celebrateSuccess('fireworks');
            }
            
            // Update progress bar
            updateProgressBar();
            
            // Enable next button after a delay
            setTimeout(() => {
                document.getElementById('quiz-next-btn').disabled = false;
            }, 1000);
        }

        function quizNext() {
            if (currentQuiz.currentQuestionIndex < currentQuiz.questions.length - 1) {
                currentQuiz.currentQuestionIndex++;
                displayQuestion();
                document.getElementById('quiz-next-btn').disabled = true;
            } else {
                showQuizResults();
            }
        }

        function quizPrevious() {
            if (currentQuiz.currentQuestionIndex > 0) {
                currentQuiz.currentQuestionIndex--;
                displayQuestion();
            }
        }

        function updateProgressBar() {
            const progress = (currentQuiz.currentQuestionIndex / currentQuiz.questions.length) * 100;
            document.getElementById('quiz-progress').style.width = `${progress}%`;
        }

        function showQuizResults() {
            document.getElementById('quiz-content').style.display = 'none';
            document.getElementById('quiz-results').style.display = 'block';
            
            const totalQuestions = currentQuiz.questions.length;
            const percentage = Math.round((currentQuiz.score / totalQuestions) * 100);
            
            document.getElementById('quiz-score').textContent = `Your score: ${currentQuiz.score}/${totalQuestions} (${percentage}%)`;
            document.getElementById('correct-answers').textContent = currentQuiz.score;
            document.getElementById('incorrect-answers').textContent = totalQuestions - currentQuiz.score;
            
            // Set appropriate emoji based on score
            const emoji = document.getElementById('result-emoji');
            if (percentage >= 80) {
                emoji.textContent = 'üéâ';
                celebrateSuccess('balloons');
            } else if (percentage >= 60) {
                emoji.textContent = 'üëç';
                celebrateSuccess('rockets');
            } else {
                emoji.textContent = 'üòä';
                celebrateSuccess('fireworks');
            }
        }

        function restartQuiz() {
            startQuiz();
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', function() {
            renderMembers();
            startFamilyMemory(4);
            startQuiz();
        });
    </script>
</body>
</html>