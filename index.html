<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Future Focus</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabaseClient.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --accent:#ff6f61;
            --accent-2:#7c4dff;
            --shadow:0 10px 25px rgba(0,0,0,.12);
            --radius:22px;
        }
        *{box-sizing:border-box}
        html,body{margin:0}
        body{
            font-family:"Poppins",sans-serif;
            color:#222;
            background:linear-gradient(180deg,#fdfbfb,#ebedee);
            overflow-x:hidden;
        }
        a{text-decoration:none;color:inherit}

        /* NAV */
        .nav{position:sticky;top:0;z-index:50;background:#fff;box-shadow:0 2px 14px rgba(0,0,0,.05)}
        .nav-inner{max-width:1200px;margin:auto;padding:14px 20px;display:flex;align-items:center}
        .brand{font-weight:700;font-size:22px;color:var(--accent)}
        .nav-links{margin-left:auto;display:flex;gap:18px; align-items: center;}
        .nav-links a{font-weight:600;color:#475467}
        .nav-links a:hover{color:var(--accent)}

        /* Nav Login/User Display Link Styling */
        #user-auth-link {
            padding: 8px 16px;
            border-radius: 20px;
            background: var(--accent-2); /* A secondary accent color (for Log In state) */
            color: #fff;
            font-weight: 700;
            transition: .3s;
            box-shadow: 0 4px 6px rgba(0,0,0,.1);
            line-height: 1;
            white-space: nowrap;
            max-width: 150px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        #user-auth-link:hover {
            background: #6a3dbf;
        }
        /* Specific style for when it displays the user name (overwritten in JS) */
        .logged-in-badge {
            background: #e0f2f1 !important; /* Light teal */
            color: #0d9488 !important; /* Dark teal */
            border: 1px solid #14b8a6;
            cursor: default !important;
        }

        /* HERO - Title is left-aligned */
        .hero{
            position:relative;
            text-align:left;
            padding:80px 20px;
            color:#222;
            background:linear-gradient(135deg,#ffecd2,#fcb69f,#a1c4fd,#c2e9fb);
            overflow:hidden;
        }
        .hero h1{font-size:clamp(30px,5vw,48px);margin-bottom:14px}
        .hero p{max-width:650px;font-size:18px;color:#444}

        /* Hero Buttons Container - Buttons are left-aligned */
        .hero-buttons {
            display: flex;
            justify-content: flex-start;
            gap: 15px; /* Space between the two buttons */
            margin-top: 22px;
        }

        /* Main Button Styling */
        .hero-buttons button{
            padding:14px 30px; /* Slightly larger padding */
            border:none;
            border-radius:30px;
            background:var(--accent);
            color:#fff;
            font-size:18px; /* Slightly larger font */
            font-weight:700; /* Bolder font */
            cursor:pointer;
            transition:.3s;
            box-shadow: 0 4px 10px rgba(255, 111, 97, 0.4);
            text-transform: uppercase;
        }
        .hero-buttons button:hover{background:#e85a4f;transform:scale(1.05)}

        /* PLANE ANIMATION */
        .plane{
            position:absolute;top:40px;left:-150px;font-size:40px;
            animation:fly 15s linear infinite;
        }
        @keyframes fly{
            0%{transform:translateX(-200px) rotate(0deg)}
            50%{transform:translateX(120vw) rotate(5deg)}
            100%{transform:translateX(-200px) rotate(0deg)}
        }

        /* STARS */
        .star{
            position:absolute;width:4px;height:4px;border-radius:50%;
            background:white;opacity:.8;
            animation:twinkle 3s infinite alternate;
        }
        @keyframes twinkle{
            from{opacity:.2}
            to{opacity:1}
        }

        /* SECTION */
        .section{max-width:1200px;margin:60px auto;padding:0 20px;text-align:center}
        .section h2{font-size:28px;margin-bottom:20px;color:var(--accent)}
        .grid{
            display:grid;gap:22px;
            grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
        }
        .card{
            background:#fff;border-radius:var(--radius);
            padding:26px 20px;box-shadow:var(--shadow);
            transition:.3s;cursor:pointer;position:relative;overflow:hidden;
        }
        .card:hover{transform:translateY(-6px);box-shadow:0 14px 30px rgba(0,0,0,.15)}
        .icon{
            font-size:40px;margin-bottom:10px;transition:.4s;
            display:inline-block;
        }
        .card:hover .icon{transform:rotate(10deg) scale(1.2)}
        .card h3{margin:0 0 8px;font-size:18px}
        .card p{margin:0;color:#666;font-size:14px}

        /* CONFETTI */
        .confetti{
            position:fixed;width:8px;height:10px;
            transform:translate(-50%,-50%);
            animation:fall .9s ease-out forwards;border-radius:2px;
        }
        @keyframes fall{
            0%{opacity:1}
            100%{transform:translate(-50%,40px) rotate(320deg);opacity:0}
        }

        footer{text-align:center;padding:30px;color:#555;background:#fff;border-top:1px solid #eee}
    </style>
</head>
<body>

<header class="nav">
    <div class="nav-inner">
        <div class="brand">Future Focus</div>
        <nav class="nav-links">
            <a href="#home">Home</a>
            <a href="#topics">Topics</a>
            <a href="#about">About</a>
            <a id="user-auth-link" href="/login.html" style="display: none;">Log In</a>
            <a id="logout-link" href="#" onclick="logout()" style="color: var(--accent); font-weight: 700; display: none;">Logout</a>
        </nav>
    </div>
</header>

<section id="home" class="hero">
    <span class="plane">‚úàÔ∏è</span>
    <h1>Make Learning Bright & Fun ‚ú®</h1>
    <p>Engaging lessons, colorful visuals, and interactive play to help kids grow joyfully.</p>

    <div class="hero-buttons">
        <button id="hero-main-button" onclick="handleHeroButtonClick()">
            Log In / Join üîë
        </button>
    </div>
</section>

<section id="topics" class="section">
    <h2>Explore Topics</h2>
    <div class="grid" id="grid">
        <div class="card" onclick="navigateToPage('english-alphabet')">
            <div class="icon">üî§</div>
            <h3>English Alphabet</h3>
            <p>Letters & sounds</p>
        </div>
        <div class="card" onclick="navigateToPage('amharic-alphabet')">
            <div class="icon">üá™üáπ</div>
            <h3>Amharic Alphabet</h3>
            <p>Learn Fidel</p>
        </div>
        <div class="card" onclick="navigateToPage('Numbers')">
            <div class="icon">üî¢</div>
            <h3>Numbers</h3>
            <p>Counting & math</p>
        </div>
        <div class="card" onclick="navigateToPage('colors')">
            <div class="icon">üé®</div>
            <h3>Colors</h3>
            <p>Mix & match</p>
        </div>
        <div class="card" onclick="navigateToPage('shapes')">
            <div class="icon">‚úèÔ∏è</div>
            <h3>Lines & Shapes</h3>
            <p>Trace & draw</p>
        </div>
        <div class="card" onclick="navigateToPage('body-parts')">
            <div class="icon">üßí</div>
            <h3>Body Parts</h3>
            <p>See & learn</p>
        </div>
        <div class="card" onclick="navigateToPage('family')">
            <div class="icon">üë®‚Äçüë©‚Äçüëß</div>
            <h3>Family</h3>
            <p>Meet everyone</p>
        </div>
        <div class="card" onclick="navigateToPage('stories')">
            <div class="icon">üìñ</div>
            <h3>Stories</h3>
            <p>Read & enjoy</p>
        </div>
        <div class="card" onclick="navigateToPage('animals')">
            <div class="icon">üê∂</div>
            <h3>Animals</h3>
            <p>Roars & facts</p>
        </div>
        <div class="card" onclick="navigateToPage('Games')">
            <div class="icon">üéÆ</div>
            <h3>Games</h3>
            <p>Play & learn</p>
        </div>
        <div class="card" onclick="navigateToPage('Vegetables')">
            <div class="icon">ü•¶</div>
            <h3>Vegetables</h3>
            <p>Healthy & green</p>
        </div>
        <div class="card" onclick="navigateToPage('Fruits')">
            <div class="icon">üçé</div>
            <h3>Fruits</h3>
            <p>Sweet & colorful</p>
        </div>
    </div>
</section>

<section id="about" class="section">
    <h2>About Us</h2>
    <p style="max-width:700px;margin:auto;color:#555">
        Kids Fun Learning is a joyful platform where education meets play.
        We use colors, motion, and stories to keep kids excited while learning.
    </p>
</section>

<footer>
    ¬© 2025 Kids Fun Learning ‚Ä¢ Made with ‚ù§Ô∏è
</footer>

<script>
    // --- AUTH AND UI TOGGLE ELEMENTS ---
    const userAuthLink = document.getElementById('user-auth-link');
    const logoutLink = document.getElementById('logout-link');
    const heroMainButton = document.getElementById('hero-main-button');
    let isUserLoggedIn = false; // Global flag to track authentication state

    /**
     * Handles the click action for the main hero button.
     * Scrolls to content if logged in, redirects to login page if logged out.
     */
    function handleHeroButtonClick() {
        if (isUserLoggedIn) {
            // Logged in: Scroll to the topics section
            document.getElementById('topics').scrollIntoView({behavior:'smooth'});
        } else {
            // Logged out: Go to the login page
            window.location.href = '/login.html';
        }
    }

    /**
     * Updates the UI based on the current user object.
     * This function is called by the Supabase auth listener.
     * @param {Object | null} user The current Supabase user object or null.
     */
    function updateUIOnAuthChange(user) {
        if (user) {
            // User is logged in: SHOW LOGOUT, DISPLAY USER NAME/EMAIL IN NAV
            isUserLoggedIn = true;

            // 1. Determine Display Name (from user_metadata.name or truncated email)
            let rawName = user.user_metadata?.name;
            let displayName;

            if (rawName) {
                // Use provided name and truncate if long
                displayName = rawName.length > 15 ? rawName.substring(0, 13) + '...' : rawName;
            } else {
                // Fallback for existing users (using email, truncated before the @)
                let emailPart = user.email ? user.email.substring(0, user.email.indexOf('@')) : 'User';
                displayName = emailPart.length > 12 ? emailPart.substring(0, 10) + '...' : emailPart;
            }

            // 2. Update Nav Link to display Name/Email
            userAuthLink.textContent = `Hello, ${displayName} üëã`;
            userAuthLink.href = '#'; // Not clickable
            userAuthLink.classList.add('logged-in-badge');
            userAuthLink.style.display = 'block';

            // 3. Update main hero button text and HIDE the button element
            heroMainButton.textContent = "Continue Learning üöÄ";
            heroMainButton.style.display = 'block'; // Ensure text is visible for a moment
            heroMainButton.parentNode.style.display = 'none'; // HIDE the whole button container to remove redundancy

            // 4. Set logout link
            logoutLink.style.display = 'block';

        } else {
            // User is NOT logged in: SHOW LOGIN, HIDE LOGOUT
            isUserLoggedIn = false;

            // 1. Reset Nav Link to Log In state
            userAuthLink.textContent = 'Log In';
            userAuthLink.href = '/login.html';
            userAuthLink.classList.remove('logged-in-badge');
            userAuthLink.style.display = 'block';

            // 2. Hide logout link
            logoutLink.style.display = 'none';

            // 3. Show main hero button
            heroMainButton.textContent = "Log In / Join üîë";
            heroMainButton.parentNode.style.display = 'flex'; // SHOW the button container
        }
    }

    // --- MAIN EXECUTION: Use onAuthStateChange for reliable state detection ---
    if (typeof supabaseClient !== 'undefined') {
        // This listener fires whenever the user logs in, logs out, or the session is refreshed.
        supabaseClient.auth.onAuthStateChange((event, session) => {
            // session?.user provides the user object if a session exists, otherwise it's null
            updateUIOnAuthChange(session?.user || null);
        });
    } else {
        console.error("Supabase client is missing. Cannot check auth state.");
        userAuthLink.style.display = 'block';
    }


    // --- UTILITIES (confetti, navigation, logout) ---

    // Generate stars in hero
    for(let i=0;i<20;i++){
        let s=document.createElement("div");
        s.className="star";
        s.style.left=Math.random()*100+"%";
        s.style.top=Math.random()*100+"%";
        s.style.animationDelay=Math.random()*5+"s";
        document.querySelector(".hero").appendChild(s);
    }

    // Confetti burst on card click
    document.getElementById("grid").addEventListener("click",e=>{
        const card=e.target.closest(".card"); if(!card) return;
        confettiBurst(e.clientX,e.clientY);
    });
    function confettiBurst(x,y){
        const colors=['#ff6f61','#ffb84d','#4dd0e1','#7c4dff','#4caf50','#ffd700'];
        for(let i=0;i<14;i++){
            const piece=document.createElement('i');
            piece.className='confetti';
            piece.style.left=x+(Math.random()*40-20)+'px';
            piece.style.top=y+(Math.random()*6-3)+'px';
            piece.style.background=colors[i%colors.length];
            piece.style.transform+=` rotate(${Math.random()*360}deg)`;
            piece.style.width=(6+Math.random()*6)+'px';
            piece.style.height=(6+Math.random()*9)+'px';
            document.body.appendChild(piece);
            setTimeout(()=>piece.remove(),900);
        }
    }

    // Navigation function
    function navigateToPage(category) {
        window.location.href = `/${encodeURIComponent(category)}.html`;
    }

    // Logout function
    async function logout() {
        try {
            if (typeof supabaseClient === 'undefined') {
                console.error("Supabase client not available for logout.");
                window.location.href = "/login.html";
                return;
            }
            const { error } = await supabaseClient.auth.signOut();
            if (error) throw error;
            // The onAuthStateChange listener will now handle the UI update immediately.
            window.location.href = "/index.html";
        } catch (error) {
            console.error("Logout error:", error.message);
        }
    }
</script>
</body>
</html>
